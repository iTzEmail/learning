/*! For license information please see login.js.LICENSE.txt */
(()=>{"use strict";var e={82:(e,t,n)=>{n.d(t,{CI:()=>i.D,hg:()=>i.z,x9:()=>i.ac,xI:()=>i.p});var i=n(542);n(943),n(625),n(722),n(711)},109:(e,t,n)=>{n.d(t,{j2:()=>c});var i=n(943);(0,i.KO)("firebase","12.4.0","app");var s=n(908),r=n(589),o=n(290);const a=(0,i.Wp)({apiKey:"AIzaSyDYCId6a0xOqbDi13rko_bSvIRv0KNmcNI",authDomain:"fir-9-26d77.firebaseapp.com",projectId:"fir-9-26d77",storageBucket:"fir-9-26d77.firebasestorage.app",messagingSenderId:"995514548945",appId:"1:995514548945:web:a43c7592b043b164f17bf0",measurementId:"G-BPNQ5G1XH0"}),c=(0,s.xI)(a);(0,r.aU)(a),(0,o.C3)(a)},290:(e,t,n)=>{n.d(t,{C3:()=>Ii});var i=n(943),s=n(711),r=n(625),o=n(722);const a="@firebase/database",c="1.1.0";let h="";class l{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,r.As)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,r.$L)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class u{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,r.gR)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const d=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new l(t)}}catch(e){}return new u},p=d("localStorage"),f=d("sessionStorage"),g=new o.Vy("@firebase/database"),m=function(){let e=1;return function(){return e++}}(),_=function(e){const t=(0,r.kj)(e),n=new r.gz;n.update(t);const i=n.digest();return r.K3.encodeByteArray(i)},y=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=y.apply(null,i):t+="object"==typeof i?(0,r.As)(i):i,t+=" "}return t};let v=null,w=!0;const I=function(...e){if(!0===w&&(w=!1,null===v&&!0===f.get("logging_enabled")&&(t=!0,(0,r.vA)(!n||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(g.logLevel=o.$b.VERBOSE,v=g.log.bind(g),n&&f.set("logging_enabled",!0)):"function"==typeof t?v=t:(v=null,f.remove("logging_enabled")))),v){const t=y.apply(null,e);v(t)}var t,n},E=function(e){return function(...t){I(e,...t)}},T=function(...e){const t="FIREBASE INTERNAL ERROR: "+y(...e);g.error(t)},b=function(...e){const t=`FIREBASE FATAL ERROR: ${y(...e)}`;throw g.error(t),new Error(t)},C=function(...e){const t="FIREBASE WARNING: "+y(...e);g.warn(t)},S=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},k="[MIN_NAME]",A="[MAX_NAME]",N=function(e,t){if(e===t)return 0;if(e===k||t===A)return-1;if(t===k||e===A)return 1;{const n=F(e),i=F(t);return null!==n?null!==i?n-i===0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},R=function(e,t){return e===t?0:e<t?-1:1},P=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,r.As)(t))},O=function(e){if("object"!=typeof e||null===e)return(0,r.As)(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=(0,r.As)(t[i]),n+=":",n+=O(e[t[i]]);return n+="}",n},D=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let s=0;s<n;s+=t)s+t>n?i.push(e.substring(s,n)):i.push(e.substring(s,s+t));return i};function x(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const L=function(e){(0,r.vA)(!S(e),"Invalid JSON number");let t,n,i,s,o;0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=s+1023,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const c=a.join("");let h="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()},M=new RegExp("^-?(0*)\\d{1,10}$"),F=function(e){if(M.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},U=function(e){try{e()}catch(e){setTimeout(()=>{const t=e.stack||"";throw C("Exception was thrown by user callback.",t),e},Math.floor(0))}},V=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class j{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,(0,i.xZ)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){C(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class q{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(I("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',C(e)}}class B{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}B.OWNER="owner";const H="5",W=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$="ac",z="websocket",K="long_polling";class G{constructor(e,t,n,i,s=!1,r="",o=!1,a=!1,c=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=p.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&p.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Q(e,t,n){let i;if((0,r.vA)("string"==typeof t,"typeof type must == string"),(0,r.vA)("object"==typeof n,"typeof params must == object"),t===z)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==K)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const s=[];return x(n,(e,t)=>{s.push(e+"="+t)}),i+s.join("&")}class Y{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,r.gR)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,r.A4)(this.counters_)}}const J={},X={};function Z(e){const t=e.toString();return J[t]||(J[t]=new Y),J[t]}class ee{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&U(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const te="start";class ne{constructor(e,t,n,i,s,r,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(e),this.stats_=Z(t),this.urlFn=e=>(this.appCheckToken&&(e[$]=this.appCheckToken),Q(t,K,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ee(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if((0,r.$g)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ie((...e)=>{const[t,n,i,s,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===te)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={};e[te]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=H,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[$]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&W.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ne.forceAllow_=!0}static forceDisallow(){ne.forceDisallow_=!0}static isAvailable(){return!((0,r.$g)()||!ne.forceAllow_&&(ne.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,r.As)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=(0,r.KA)(t),i=D(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,r.$g)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,r.As)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ie{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,r.$g)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=m(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=ie.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){I("frame writing exception"),e.stack&&I(e.stack),I(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||I("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){(0,r.$g)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{I("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let se=null;"undefined"!=typeof MozWebSocket?se=MozWebSocket:"undefined"!=typeof WebSocket&&(se=WebSocket);class re{constructor(e,t,n,i,s,r,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=Z(t),this.connURL=re.connectionURL_(t,r,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,s){const o={};return o.v=H,!(0,r.$g)()&&"undefined"!=typeof location&&location.hostname&&W.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),i&&(o[$]=i),s&&(o.p=s),Q(e,z,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,p.set("previous_websocket_failure",!0);try{let e;if((0,r.$g)()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${H}/${h}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n=process.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new se(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){re.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==se&&!re.forceDisallow_}static previouslyFailed(){return p.isInMemoryStorage||!0===p.get("previous_websocket_failure")}markConnectionHealthy(){p.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=(0,r.$L)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,r.vA)(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=(0,r.As)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=D(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}re.responsesRequiredToBeHealthy=2,re.healthyTimeout=3e4;class oe{static get ALL_TRANSPORTS(){return[ne,re]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=re&&re.isAvailable();let n=t&&!re.previouslyFailed();if(e.webSocketOnly&&(t||C("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[re];else{const e=this.transports_=[];for(const t of oe.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);oe.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}oe.globalTransportInitialized_=!1;class ae{constructor(e,t,n,i,s,r,o,a,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new oe(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=V(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=P("t",e),n=P("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=P("t",e),n=P("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=P("t",e);if("d"in e){const n=e.d;if("h"===t){const e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?T("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):T("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),H!==n&&C("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),V(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):V(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(p.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ce{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class he{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,r.vA)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){(0,r.vA)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class le extends he{static getInstance(){return new le}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,r.jZ)()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return(0,r.vA)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class ue{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function de(){return new ue("")}function pe(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function fe(e){return e.pieces_.length-e.pieceNum_}function ge(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new ue(e.pieces_,t)}function me(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function _e(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ye(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new ue(t,0)}function ve(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof ue)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new ue(n,0)}function we(e){return e.pieceNum_>=e.pieces_.length}function Ie(e,t){const n=pe(e),i=pe(t);if(null===n)return t;if(n===i)return Ie(ge(e),ge(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ee(e,t){if(fe(e)!==fe(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Te(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(fe(e)>fe(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class be{constructor(e,t){this.errorPrefix_=t,this.parts_=_e(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,r.OE)(this.parts_[e]);Ce(this)}}function Ce(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Se(e))}function Se(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class ke extends he{static getInstance(){return new ke}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return(0,r.vA)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Ae=1e3;class Ne extends ce{constructor(e,t,n,i,s,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Ne.nextPersistentConnectionId_++,this.log_=E("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ae,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!(0,r.$g)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ke.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&le.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_((0,r.As)(s)),(0,r.vA)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new r.cY,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),(0,r.vA)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,r.vA)(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,s=>{const r=s.d,o=s.s;Ne.warnOnListenWarnings_(r,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,r))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,r.gR)(e,"w")){const n=(0,r.yw)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();C(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,r.qc)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=(0,r.Cv)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),(0,r.vA)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,s){this.initConnection_();const r={p:t,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:e,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,r.As)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):T("Unrecognized action received from server: "+(0,r.As)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,r.vA)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ae,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ae,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ae),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Ne.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},h=function(e){(0,r.vA)(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:h};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[r,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?I("getToken() completed but was canceled"):(I("getToken() completed. Creating connection."),this.authToken_=r&&r.accessToken,this.appCheckToken_=c&&c.token,a=new ae(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{C(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&C(e),c())}}}interrupt(e){I("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){I("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,r.Im)(this.interruptReasons_)&&(this.reconnectDelay_=Ae,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>O(e)).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new ue(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){I("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){I("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";(0,r.$g)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+h.replace(/\./g,"-")]=1,(0,r.jZ)()?e["framework.cordova"]=1:(0,r.lV)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=le.getInstance().currentlyOnline();return(0,r.Im)(this.interruptReasons_)&&e}}Ne.nextPersistentConnectionId_=0,Ne.nextConnectionId_=0;class Re{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Re(e,t)}}class Pe{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Re(k,e),i=new Re(k,t);return 0!==this.compare(n,i)}minPost(){return Re.MIN}}let Oe;class De extends Pe{static get __EMPTY_NODE(){return Oe}static set __EMPTY_NODE(e){Oe=e}compare(e,t){return N(e.name,t.name)}isDefinedOn(e){throw(0,r.Hk)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Re.MIN}maxPost(){return new Re(A,Oe)}makePost(e,t){return(0,r.vA)("string"==typeof e,"KeyIndex indexValue must always be a string."),new Re(e,Oe)}toString(){return".key"}}const xe=new De;class Le{constructor(e,t,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse_?e.left:e.right;else{if(0===r){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Me{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Me.RED,this.left=null!=i?i:Fe.EMPTY_NODE,this.right=null!=s?s:Fe.EMPTY_NODE}copy(e,t,n,i,s){return new Me(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Fe.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Fe.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Me.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Me.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Me.RED=!0,Me.BLACK=!1;class Fe{constructor(e,t=Fe.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Fe(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Me.BLACK,null,null))}remove(e){return new Fe(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Me.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Le(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Le(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Le(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Le(this.root_,null,this.comparator_,!0,e)}}function Ue(e,t){return N(e.name,t.name)}function Ve(e,t){return N(e,t)}let je;Fe.EMPTY_NODE=new class{copy(e,t,n,i,s){return this}insert(e,t,n){return new Me(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const qe=function(e){return"number"==typeof e?"number:"+L(e):"string:"+e},Be=function(e){if(e.isLeafNode()){const t=e.val();(0,r.vA)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,r.gR)(t,".sv"),"Priority must be a string or number.")}else(0,r.vA)(e===je||e.isEmpty(),"priority of unexpected type.");(0,r.vA)(e===je||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let He,We,$e;class ze{static set __childrenNodeConstructor(e){He=e}static get __childrenNodeConstructor(){return He}constructor(e,t=ze.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,r.vA)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Be(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ze(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ze.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return we(e)?this:".priority"===pe(e)?this.priorityNode_:ze.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ze.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=pe(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,r.vA)(".priority"!==n||1===fe(e),".priority must be the last token in a path"),this.updateImmediateChild(n,ze.__childrenNodeConstructor.EMPTY_NODE.updateChild(ge(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+qe(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?L(this.value_):this.value_,this.lazyHash_=_(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ze.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ze.__childrenNodeConstructor?-1:((0,r.vA)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=ze.VALUE_TYPE_ORDER.indexOf(t),s=ze.VALUE_TYPE_ORDER.indexOf(n);return(0,r.vA)(i>=0,"Unknown leaf type: "+t),(0,r.vA)(s>=0,"Unknown leaf type: "+n),i===s?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}ze.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Ke=new class extends Pe{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return 0===s?N(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Re.MIN}maxPost(){return new Re(A,new ze("[PRIORITY-POST]",$e))}makePost(e,t){const n=We(e);return new Re(t,new ze("[PRIORITY-POST]",n))}toString(){return".priority"}},Ge=Math.log(2);class Qe{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ge,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ye=function(e,t,n,i){e.sort(t);const s=function(t,i){const r=i-t;let o,a;if(0===r)return null;if(1===r)return o=e[t],a=n?n(o):o,new Me(a,o.node,Me.BLACK,null,null);{const c=parseInt(r/2,10)+t,h=s(t,c),l=s(c+1,i);return o=e[c],a=n?n(o):o,new Me(a,o.node,Me.BLACK,h,l)}},r=function(t){let i=null,r=null,o=e.length;const a=function(t,i){const r=o-t,a=o;o-=t;const h=s(r+1,a),l=e[r],u=n?n(l):l;c(new Me(u,l.node,i,null,h))},c=function(e){i?(i.left=e,i=e):(r=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Me.BLACK):(a(i,Me.BLACK),a(i,Me.RED))}return r}(new Qe(e.length));return new Fe(i||t,r)};let Je;const Xe={};class Ze{static get Default(){return(0,r.vA)(Xe&&Ke,"ChildrenNode.ts has not been loaded"),Je=Je||new Ze({".priority":Xe},{".priority":Ke}),Je}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=(0,r.yw)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Fe?t:null}hasIndex(e){return(0,r.gR)(this.indexSet_,e.toString())}addIndex(e,t){(0,r.vA)(e!==xe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const s=t.getIterator(Re.Wrap);let o,a=s.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=s.getNext();o=i?Ye(n,e.getCompare()):Xe;const c=e.toString(),h={...this.indexSet_};h[c]=e;const l={...this.indexes_};return l[c]=o,new Ze(l,h)}addToIndexes(e,t){const n=(0,r.kH)(this.indexes_,(n,i)=>{const s=(0,r.yw)(this.indexSet_,i);if((0,r.vA)(s,"Missing index implementation for "+i),n===Xe){if(s.isDefinedOn(e.node)){const n=[],i=t.getIterator(Re.Wrap);let r=i.getNext();for(;r;)r.name!==e.name&&n.push(r),r=i.getNext();return n.push(e),Ye(n,s.getCompare())}return Xe}{const i=t.get(e.name);let s=n;return i&&(s=s.remove(new Re(e.name,i))),s.insert(e,e.node)}});return new Ze(n,this.indexSet_)}removeFromIndexes(e,t){const n=(0,r.kH)(this.indexes_,n=>{if(n===Xe)return n;{const i=t.get(e.name);return i?n.remove(new Re(e.name,i)):n}});return new Ze(n,this.indexSet_)}}let et;class tt{static get EMPTY_NODE(){return et||(et=new tt(new Fe(Ve),null,Ze.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Be(this.priorityNode_),this.children_.isEmpty()&&(0,r.vA)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||et}updatePriority(e){return this.children_.isEmpty()?this:new tt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?et:t}}getChild(e){const t=pe(e);return null===t?this:this.getImmediateChild(t).getChild(ge(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,r.vA)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Re(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(n,this.children_));const r=i.isEmpty()?et:this.priorityNode_;return new tt(i,r,s)}}updateChild(e,t){const n=pe(e);if(null===n)return t;{(0,r.vA)(".priority"!==pe(e)||1===fe(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(ge(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,s=!0;if(this.forEachChild(Ke,(r,o)=>{t[r]=o.val(e),n++,s&&tt.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1}),!e&&s&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+qe(this.getPriority().val())+":"),this.forEachChild(Ke,(t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":_(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Re(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Re(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Re(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,Re.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,Re.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===nt?-1:0}withIndex(e){if(e===xe||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new tt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===xe||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Ke),n=t.getIterator(Ke);let i=e.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=e.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(e){return e===xe?null:this.indexMap_.get(e.toString())}}tt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const nt=new class extends tt{constructor(){super(new Fe(Ve),tt.EMPTY_NODE,Ze.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return tt.EMPTY_NODE}isEmpty(){return!1}};function it(e,t=null){if(null===e)return tt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,r.vA)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new ze(e,it(t));if(e instanceof Array){let n=tt.EMPTY_NODE;return x(e,(t,i)=>{if((0,r.gR)(e,t)&&"."!==t.substring(0,1)){const e=it(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}}),n.updatePriority(it(t))}{const n=[];let i=!1;if(x(e,(e,t)=>{if("."!==e.substring(0,1)){const s=it(t);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),n.push(new Re(e,s)))}}),0===n.length)return tt.EMPTY_NODE;const s=Ye(n,Ue,e=>e.name,Ve);if(i){const e=Ye(n,Ke.getCompare());return new tt(s,it(t),new Ze({".priority":e},{".priority":Ke}))}return new tt(s,it(t),Ze.Default)}}Object.defineProperties(Re,{MIN:{value:new Re(k,tt.EMPTY_NODE)},MAX:{value:new Re(A,nt)}}),De.__EMPTY_NODE=tt.EMPTY_NODE,ze.__childrenNodeConstructor=tt,je=nt,$e=nt,function(e){We=e}(it);class st extends Pe{constructor(e){super(),this.indexPath_=e,(0,r.vA)(!we(e)&&".priority"!==pe(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return 0===s?N(e.name,t.name):s}makePost(e,t){const n=it(e),i=tt.EMPTY_NODE.updateChild(this.indexPath_,n);return new Re(t,i)}maxPost(){const e=tt.EMPTY_NODE.updateChild(this.indexPath_,nt);return new Re(A,e)}toString(){return _e(this.indexPath_,0).join("/")}}const rt=new class extends Pe{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?N(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Re.MIN}maxPost(){return Re.MAX}makePost(e,t){const n=it(e);return new Re(t,n)}toString(){return".value"}};function ot(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class at{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ke}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,r.vA)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,r.vA)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:k}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,r.vA)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,r.vA)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:A}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,r.vA)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ke}copy(){const e=new at;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ct(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Ke?n="$priority":e.index_===rt?n="$value":e.index_===xe?n="$key":((0,r.vA)(e.index_ instanceof st,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=(0,r.As)(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=(0,r.As)(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+(0,r.As)(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=(0,r.As)(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+(0,r.As)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function ht(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Ke&&(t.i=e.index_.toString()),t}class lt extends ce{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,r.vA)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=E("p:rest:"),this.listens_={}}listen(e,t,n,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=lt.getListenId_(e,n),a={};this.listens_[o]=a;const c=ct(e._queryParams);this.restRequest_(s+".json",c,(e,t)=>{let c=t;if(404===e&&(c=null,e=null),null===e&&this.onDataUpdate_(s,c,!1,n),(0,r.yw)(this.listens_,o)===a){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}})}unlisten(e,t){const n=lt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=ct(e._queryParams),n=e._path.toString(),i=new r.cY;return this.restRequest_(n+".json",t,(e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,r.Am)(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=(0,r.$L)(a.responseText)}catch(e){C("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&C("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}}class ut{constructor(){this.rootNode_=tt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function dt(){return{value:null,children:new Map}}function pt(e,t,n){if(we(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=pe(t);e.children.has(i)||e.children.set(i,dt()),pt(e.children.get(i),t=ge(t),n)}}function ft(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,i)=>{ft(i,new ue(t.toString()+"/"+e),n)})}class gt{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&x(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class mt{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new gt(e);const n=1e4+2e4*Math.random();V(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;x(e,(e,i)=>{i>0&&(0,r.gR)(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),V(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var _t;function yt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(_t||(_t={}));class vt{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=_t.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(we(this.path)){if(null!=this.affectedTree.value)return(0,r.vA)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ue(e));return new vt(de(),t,this.revert)}}return(0,r.vA)(pe(this.path)===e,"operationForChild called for unrelated child."),new vt(ge(this.path),this.affectedTree,this.revert)}}class wt{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=_t.OVERWRITE}operationForChild(e){return we(this.path)?new wt(this.source,de(),this.snap.getImmediateChild(e)):new wt(this.source,ge(this.path),this.snap)}}class It{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=_t.MERGE}operationForChild(e){if(we(this.path)){const t=this.children.subtree(new ue(e));return t.isEmpty()?null:t.value?new wt(this.source,de(),t.value):new It(this.source,de(),t)}return(0,r.vA)(pe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new It(this.source,ge(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Et{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(we(e))return this.isFullyInitialized()&&!this.filtered_;const t=pe(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Tt(e,t,n,i,s,o){const a=i.filter(e=>e.type===n);a.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw(0,r.Hk)("Should only compare child_ events.");const i=new Re(t.childName,t.snapshotNode),s=new Re(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n)),a.forEach(n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);s.forEach(s=>{s.respondsTo(n.type)&&t.push(s.createEvent(i,e.query_))})})}function bt(e,t){return{eventCache:e,serverCache:t}}function Ct(e,t,n,i){return bt(new Et(t,n,i),e.serverCache)}function St(e,t,n,i){return bt(e.eventCache,new Et(t,n,i))}function kt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function At(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Nt;class Rt{static fromObject(e){let t=new Rt(null);return x(e,(e,n)=>{t=t.set(new ue(e),n)}),t}constructor(e,t=(()=>(Nt||(Nt=new Fe(R)),Nt))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:de(),value:this.value};if(we(e))return null;{const n=pe(e),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(ge(e),t);return null!=s?{path:ve(new ue(n),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(we(e))return this;{const t=pe(e),n=this.children.get(t);return null!==n?n.subtree(ge(e)):new Rt(null)}}set(e,t){if(we(e))return new Rt(t,this.children);{const n=pe(e),i=(this.children.get(n)||new Rt(null)).set(ge(e),t),s=this.children.insert(n,i);return new Rt(this.value,s)}}remove(e){if(we(e))return this.children.isEmpty()?new Rt(null):new Rt(null,this.children);{const t=pe(e),n=this.children.get(t);if(n){const i=n.remove(ge(e));let s;return s=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&s.isEmpty()?new Rt(null):new Rt(this.value,s)}return this}}get(e){if(we(e))return this.value;{const t=pe(e),n=this.children.get(t);return n?n.get(ge(e)):null}}setTree(e,t){if(we(e))return t;{const n=pe(e),i=(this.children.get(n)||new Rt(null)).setTree(ge(e),t);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new Rt(this.value,s)}}fold(e){return this.fold_(de(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((i,s)=>{n[i]=s.fold_(ve(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,de(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(we(e))return null;{const i=pe(e),s=this.children.get(i);return s?s.findOnPath_(ge(e),ve(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,de(),t)}foreachOnPath_(e,t,n){if(we(e))return this;{this.value&&n(t,this.value);const i=pe(e),s=this.children.get(i);return s?s.foreachOnPath_(ge(e),ve(t,i),n):new Rt(null)}}foreach(e){this.foreach_(de(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(ve(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class Pt{constructor(e){this.writeTree_=e}static empty(){return new Pt(new Rt(null))}}function Ot(e,t,n){if(we(t))return new Pt(new Rt(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const s=i.path;let r=i.value;const o=Ie(s,t);return r=r.updateChild(o,n),new Pt(e.writeTree_.set(s,r))}{const i=new Rt(n),s=e.writeTree_.setTree(t,i);return new Pt(s)}}}function Dt(e,t,n){let i=e;return x(n,(e,n)=>{i=Ot(i,ve(t,e),n)}),i}function xt(e,t){if(we(t))return Pt.empty();{const n=e.writeTree_.setTree(t,new Rt(null));return new Pt(n)}}function Lt(e,t){return null!=Mt(e,t)}function Mt(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ie(n.path,t)):null}function Ft(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Ke,(e,n)=>{t.push(new Re(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new Re(e,n.value))}),t}function Ut(e,t){if(we(t))return e;{const n=Mt(e,t);return new Pt(null!=n?new Rt(n):e.writeTree_.subtree(t))}}function Vt(e){return e.writeTree_.isEmpty()}function jt(e,t){return qt(de(),e.writeTree_,t)}function qt(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal((t,s)=>{".priority"===t?((0,r.vA)(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):n=qt(ve(e,t),s,n)}),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(ve(e,".priority"),i)),n}}function Bt(e,t){return Zt(t,e)}function Ht(e,t){if(e.snap)return Te(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Te(ve(e.path,n),t))return!0;return!1}function Wt(e){return e.visible}function $t(e,t,n){let i=Pt.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){const e=o.path;let t;if(o.snap)Te(n,e)?(t=Ie(n,e),i=Ot(i,t,o.snap)):Te(e,n)&&(t=Ie(e,n),i=Ot(i,de(),o.snap.getChild(t)));else{if(!o.children)throw(0,r.Hk)("WriteRecord should have .snap or .children");if(Te(n,e))t=Ie(n,e),i=Dt(i,t,o.children);else if(Te(e,n))if(t=Ie(e,n),we(t))i=Dt(i,de(),o.children);else{const e=(0,r.yw)(o.children,pe(t));if(e){const n=e.getChild(ge(t));i=Ot(i,de(),n)}}}}}return i}function zt(e,t,n,i,s){if(i||s){const r=Ut(e.visibleWrites,t);if(!s&&Vt(r))return n;if(s||null!=n||Lt(r,de())){const r=function(e){return(e.visible||s)&&(!i||!~i.indexOf(e.writeId))&&(Te(e.path,t)||Te(t,e.path))};return jt($t(e.allWrites,r,t),n||tt.EMPTY_NODE)}return null}{const i=Mt(e.visibleWrites,t);if(null!=i)return i;{const i=Ut(e.visibleWrites,t);return Vt(i)?n:null!=n||Lt(i,de())?jt(i,n||tt.EMPTY_NODE):null}}}function Kt(e,t,n,i){return zt(e.writeTree,e.treePath,t,n,i)}function Gt(e,t){return function(e,t,n){let i=tt.EMPTY_NODE;const s=Mt(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(Ke,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(n){const s=Ut(e.visibleWrites,t);return n.forEachChild(Ke,(e,t)=>{const n=jt(Ut(s,new ue(e)),t);i=i.updateImmediateChild(e,n)}),Ft(s).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}return Ft(Ut(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}(e.writeTree,e.treePath,t)}function Qt(e,t,n,i){return function(e,t,n,i,s){(0,r.vA)(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=ve(t,n);if(Lt(e.visibleWrites,o))return null;{const t=Ut(e.visibleWrites,o);return Vt(t)?s.getChild(n):jt(t,s.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function Yt(e,t){return function(e,t){return Mt(e.visibleWrites,t)}(e.writeTree,ve(e.treePath,t))}function Jt(e,t,n){return function(e,t,n,i){const s=ve(t,n),r=Mt(e.visibleWrites,s);return null!=r?r:i.isCompleteForChild(n)?jt(Ut(e.visibleWrites,s),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Xt(e,t){return Zt(ve(e.treePath,t),e.writeTree)}function Zt(e,t){return{treePath:e,writeTree:t}}class en{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;(0,r.vA)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,r.vA)(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const o=i.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,ot(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,(s=n,{type:"child_removed",snapshotNode:i.oldSnap,childName:s}));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw(0,r.Hk)("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,ot(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e);var s}getChanges(){return Array.from(this.changeMap.values())}}const tn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class nn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Et(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Jt(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:At(this.viewCache_),s=function(e,t,n,i,s,r){return function(e,t,n,i,s,r,o){let a;const c=Ut(e.visibleWrites,t),h=Mt(c,de());if(null!=h)a=h;else{if(null==n)return[];a=jt(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<s;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,s,r)}(this.writes_,i,t,1,n,e);return 0===s.length?null:s[0]}}function sn(e,t,n,i,s,o){const a=t.eventCache;if(null!=Yt(i,n))return t;{let c,h;if(we(n))if((0,r.vA)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=At(t),s=Gt(i,n instanceof tt?n:tt.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),s,o)}else{const n=Kt(i,At(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const l=pe(n);if(".priority"===l){(0,r.vA)(1===fe(n),"Can't have a priority with additional path components");const s=a.getNode();h=t.serverCache.getNode();const o=Qt(i,n,s,h);c=null!=o?e.filter.updatePriority(s,o):a.getNode()}else{const r=ge(n);let u;if(a.isCompleteForChild(l)){h=t.serverCache.getNode();const e=Qt(i,n,a.getNode(),h);u=null!=e?a.getNode().getImmediateChild(l).updateChild(r,e):a.getNode().getImmediateChild(l)}else u=Jt(i,l,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),l,u,r,s,o):a.getNode()}}return Ct(t,c,a.isFullyInitialized()||we(n),e.filter.filtersNodes())}}function rn(e,t,n,i,s,r,o,a){const c=t.serverCache;let h;const l=o?e.filter:e.filter.getIndexedFilter();if(we(n))h=l.updateFullNode(c.getNode(),i,null);else if(l.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);h=l.updateFullNode(c.getNode(),e,null)}else{const e=pe(n);if(!c.isCompleteForPath(n)&&fe(n)>1)return t;const s=ge(n),r=c.getNode().getImmediateChild(e).updateChild(s,i);h=".priority"===e?l.updatePriority(c.getNode(),r):l.updateChild(c.getNode(),e,r,s,tn,null)}const u=St(t,h,c.isFullyInitialized()||we(n),l.filtersNodes());return sn(e,u,n,s,new nn(s,u,r),a)}function on(e,t,n,i,s,r,o){const a=t.eventCache;let c,h;const l=new nn(s,t,r);if(we(n))h=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=Ct(t,h,!0,e.filter.filtersNodes());else{const s=pe(n);if(".priority"===s)h=e.filter.updatePriority(t.eventCache.getNode(),i),c=Ct(t,h,a.isFullyInitialized(),a.isFiltered());else{const r=ge(n),h=a.getNode().getImmediateChild(s);let u;if(we(r))u=i;else{const e=l.getCompleteChild(s);u=null!=e?".priority"===me(r)&&e.getChild(ye(r)).isEmpty()?e:e.updateChild(r,i):tt.EMPTY_NODE}c=h.equals(u)?t:Ct(t,e.filter.updateChild(a.getNode(),s,u,r,l,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function an(e,t){return e.eventCache.isCompleteForChild(t)}function cn(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function hn(e,t,n,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,h=t;c=we(n)?i:new Rt(null).setTree(n,i);const l=t.serverCache.getNode();return c.children.inorderTraversal((n,i)=>{if(l.hasChild(n)){const c=cn(0,t.serverCache.getNode().getImmediateChild(n),i);h=rn(e,h,new ue(n),c,s,r,o,a)}}),c.children.inorderTraversal((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!l.hasChild(n)&&!c){const c=cn(0,t.serverCache.getNode().getImmediateChild(n),i);h=rn(e,h,new ue(n),c,s,r,o,a)}}),h}function ln(e,t){const n=At(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!we(t)&&!n.getImmediateChild(pe(t)).isEmpty())?n.getChild(t):null}function un(e,t,n,i){t.type===_t.MERGE&&null!==t.source.queryId&&((0,r.vA)(At(e.viewCache_),"We should always have a full cache before handling merges"),(0,r.vA)(kt(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,o=function(e,t,n,i,s){const o=new en;let a,c;if(n.type===_t.OVERWRITE){const h=n;h.source.fromUser?a=on(e,t,h.path,h.snap,i,s,o):((0,r.vA)(h.source.fromServer,"Unknown source."),c=h.source.tagged||t.serverCache.isFiltered()&&!we(h.path),a=rn(e,t,h.path,h.snap,i,s,c,o))}else if(n.type===_t.MERGE){const h=n;h.source.fromUser?a=function(e,t,n,i,s,r,o){let a=t;return i.foreach((i,c)=>{const h=ve(n,i);an(t,pe(h))&&(a=on(e,a,h,c,s,r,o))}),i.foreach((i,c)=>{const h=ve(n,i);an(t,pe(h))||(a=on(e,a,h,c,s,r,o))}),a}(e,t,h.path,h.children,i,s,o):((0,r.vA)(h.source.fromServer,"Unknown source."),c=h.source.tagged||t.serverCache.isFiltered(),a=hn(e,t,h.path,h.children,i,s,c,o))}else if(n.type===_t.ACK_USER_WRITE){const c=n;a=c.revert?function(e,t,n,i,s,o){let a;if(null!=Yt(i,n))return t;{const c=new nn(i,t,s),h=t.eventCache.getNode();let l;if(we(n)||".priority"===pe(n)){let n;if(t.serverCache.isFullyInitialized())n=Kt(i,At(t));else{const e=t.serverCache.getNode();(0,r.vA)(e instanceof tt,"serverChildren would be complete if leaf node"),n=Gt(i,e)}l=e.filter.updateFullNode(h,n,o)}else{const s=pe(n);let r=Jt(i,s,t.serverCache);null==r&&t.serverCache.isCompleteForChild(s)&&(r=h.getImmediateChild(s)),l=null!=r?e.filter.updateChild(h,s,r,ge(n),c,o):t.eventCache.getNode().hasChild(s)?e.filter.updateChild(h,s,tt.EMPTY_NODE,ge(n),c,o):h,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=Kt(i,At(t)),a.isLeafNode()&&(l=e.filter.updateFullNode(l,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=Yt(i,de()),Ct(t,l,a,e.filter.filtersNodes())}}(e,t,c.path,i,s,o):function(e,t,n,i,s,r,o){if(null!=Yt(s,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(we(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return rn(e,t,n,c.getNode().getChild(n),s,r,a,o);if(we(n)){let i=new Rt(null);return c.getNode().forEachChild(xe,(e,t)=>{i=i.set(new ue(e),t)}),hn(e,t,n,i,s,r,a,o)}return t}{let h=new Rt(null);return i.foreach((e,t)=>{const i=ve(n,e);c.isCompleteForPath(i)&&(h=h.set(e,c.getNode().getChild(i)))}),hn(e,t,n,h,s,r,a,o)}}(e,t,c.path,c.affectedTree,i,s,o)}else{if(n.type!==_t.LISTEN_COMPLETE)throw(0,r.Hk)("Unknown operation type: "+n.type);a=function(e,t,n,i,s){const r=t.serverCache;return sn(e,St(t,r.getNode(),r.isFullyInitialized()||we(n),r.isFiltered()),n,i,tn,s)}(e,t,n.path,i,o)}const h=o.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=kt(e);(n.length>0||!e.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push({type:"value",snapshotNode:kt(t)})}}(t,a,h),{viewCache:a,changes:h}}(e.processor_,s,t,n,i);var a,c;return a=e.processor_,c=o.viewCache,(0,r.vA)(c.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),(0,r.vA)(c.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed"),(0,r.vA)(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,function(e,t,n,i){const s=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const s=[],r=[];return t.forEach(t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&r.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}),Tt(e,s,"child_removed",t,i,n),Tt(e,s,"child_added",t,i,n),Tt(e,s,"child_moved",r,i,n),Tt(e,s,"child_changed",t,i,n),Tt(e,s,"value",t,i,n),s}(e.eventGenerator_,t,n,s)}(e,o.changes,o.viewCache.eventCache.getNode(),null)}let dn,pn;function fn(e,t,n,i){const s=t.source.queryId;if(null!==s){const o=e.views.get(s);return(0,r.vA)(null!=o,"SyncTree gave us an op for an invalid query."),un(o,t,n,i)}{let s=[];for(const r of e.views.values())s=s.concat(un(r,t,n,i));return s}}function gn(e,t){let n=null;for(const i of e.views.values())n=n||ln(i,t);return n}class mn{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Rt(null),this.pendingWriteTree_={visibleWrites:Pt.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function _n(e,t,n,i,s){return function(e,t,n,i,s){(0,r.vA)(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:s}),s&&(e.visibleWrites=Ot(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,s),s?In(e,new wt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function yn(e,t,n=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);(0,r.vA)(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&Ht(t,i.path)?s=!1:Te(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?(function(e){e.visibleWrites=$t(e.allWrites,Wt,de()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(i.snap?e.visibleWrites=xt(e.visibleWrites,i.path):x(i.children,t=>{e.visibleWrites=xt(e.visibleWrites,ve(i.path,t))}),!0))}(e.pendingWriteTree_,t)){let t=new Rt(null);return null!=i.snap?t=t.set(de(),!0):x(i.children,e=>{t=t.set(new ue(e),!0)}),In(e,new vt(i.path,t,n))}return[]}function vn(e,t,n){return In(e,new wt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function wn(e,t,n){const i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,(e,n)=>{const i=gn(n,Ie(e,t));if(i)return i});return zt(i,t,s,n,!0)}function In(e,t){return En(t,e.syncPointTree_,null,Bt(e.pendingWriteTree_,de()))}function En(e,t,n,i){if(we(e.path))return Tn(e,t,n,i);{const s=t.get(de());null==n&&null!=s&&(n=gn(s,de()));let r=[];const o=pe(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Xt(i,o);r=r.concat(En(a,c,e,t))}return s&&(r=r.concat(fn(s,e,i,n))),r}}function Tn(e,t,n,i){const s=t.get(de());null==n&&null!=s&&(n=gn(s,de()));let r=[];return t.children.inorderTraversal((t,s)=>{const o=n?n.getImmediateChild(t):null,a=Xt(i,t),c=e.operationForChild(t);c&&(r=r.concat(Tn(c,s,o,a)))}),s&&(r=r.concat(fn(s,e,i,n))),r}function bn(e,t){return e.tagToQueryMap.get(t)}function Cn(e){const t=e.indexOf("$");return(0,r.vA)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new ue(e.substr(0,t))}}function Sn(e,t,n){const i=e.syncPointTree_.get(t);return(0,r.vA)(i,"Missing sync point for query tag that we're tracking"),fn(i,n,Bt(e.pendingWriteTree_,t),null)}class kn{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new kn(t)}node(){return this.node_}}class An{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ve(this.path_,e);return new An(this.syncTree_,t)}node(){return wn(this.syncTree_,this.path_)}}const Nn=function(e,t,n){return e&&"object"==typeof e?((0,r.vA)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Rn(e[".sv"],t,n):"object"==typeof e[".sv"]?Pn(e[".sv"],t):void(0,r.vA)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Rn=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,r.vA)(!1,"Unexpected server value: "+e)},Pn=function(e,t,n){e.hasOwnProperty("increment")||(0,r.vA)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!=typeof i&&(0,r.vA)(!1,"Unexpected increment value: "+i);const s=t.node();if((0,r.vA)(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},On=function(e,t,n){return Dn(e,new kn(t),n)};function Dn(e,t,n){const i=e.getPriority().val(),s=Nn(i,t.getImmediateChild(".priority"),n);let r;if(e.isLeafNode()){const i=e,r=Nn(i.getValue(),t,n);return r!==i.getValue()||s!==i.getPriority().val()?new ze(r,it(s)):e}{const i=e;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new ze(s))),i.forEachChild(Ke,(e,i)=>{const s=Dn(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r}}class xn{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Ln(e,t){let n=t instanceof ue?t:new ue(t),i=e,s=pe(n);for(;null!==s;){const e=(0,r.yw)(i.node.children,s)||{children:{},childCount:0};i=new xn(s,i,e),n=ge(n),s=pe(n)}return i}function Mn(e){return e.node.value}function Fn(e,t){e.node.value=t,Bn(e)}function Un(e){return e.node.childCount>0}function Vn(e,t){x(e.node.children,(n,i)=>{t(new xn(n,e,i))})}function jn(e,t,n,i){n&&!i&&t(e),Vn(e,e=>{jn(e,t,!0,i)}),n&&i&&t(e)}function qn(e){return new ue(null===e.parent?e.name:qn(e.parent)+"/"+e.name)}function Bn(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===Mn(e)&&!Un(e)}(n),s=(0,r.gR)(e.node.children,t);i&&s?(delete e.node.children[t],e.node.childCount--,Bn(e)):i||s||(e.node.children[t]=n.node,e.node.childCount++,Bn(e))}(e.parent,e.name,e)}const Hn=/[\[\].#$\/\u0000-\u001F\u007F]/,Wn=/[\[\].#$\u0000-\u001F\u007F]/,$n=10485760,zn=function(e){return"string"==typeof e&&0!==e.length&&!Hn.test(e)},Kn=function(e,t,n){const i=n instanceof ue?new be(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Se(i));if("function"==typeof t)throw new Error(e+"contains a function "+Se(i)+" with contents = "+t.toString());if(S(t))throw new Error(e+"contains "+t.toString()+" "+Se(i));if("string"==typeof t&&t.length>$n/3&&(0,r.OE)(t)>$n)throw new Error(e+"contains a string greater than "+$n+" utf8 bytes "+Se(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,s=!1;if(x(t,(t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!zn(t)))throw new Error(e+" contains an invalid key ("+t+") "+Se(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var a,c;c=t,(a=i).parts_.length>0&&(a.byteLength_+=1),a.parts_.push(c),a.byteLength_+=(0,r.OE)(c),Ce(a),Kn(e,o,i),function(e){const t=e.parts_.pop();e.byteLength_-=(0,r.OE)(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)}),n&&s)throw new Error(e+' contains ".value" child '+Se(i)+" in addition to actual children.")}},Gn=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!zn(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),function(e){return"string"==typeof e&&0!==e.length&&!Wn.test(e)}(e)}(n))throw new Error((0,r.dI)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Qn{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Yn(e,t,n){(function(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i],r=s.getPath();null===n||Ee(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)})(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const s=e.eventLists_[i];s&&(t(s.path)?(Jn(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>Te(e,t)||Te(t,e))}function Jn(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();v&&I("event: "+n.toString()),U(i)}}}class Xn{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Qn,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=dt(),this.transactionQueueTree_=new xn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Zn(e,t,n){if(e.stats_=Z(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new lt(e.repoInfo_,(t,n,i,s)=>{ni(e,t,n,i,s)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>ii(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,r.As)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Ne(e.repoInfo_,t,(t,n,i,s)=>{ni(e,t,n,i,s)},t=>{ii(e,t)},t=>{!function(e,t){x(t,(t,n)=>{si(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(t){const n=t.toString();return X[n]||(X[n]=new mt(e.stats_,e.server_)),X[n]}(e.repoInfo_),e.infoData_=new ut,e.infoSyncTree_=new mn({startListening:(t,n,i,s)=>{let r=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(r=vn(e.infoSyncTree_,t._path,o),setTimeout(()=>{s("ok")},0)),r},stopListening:()=>{}}),si(e,"connected",!1),e.serverSyncTree_=new mn({startListening:(t,n,i,s)=>(e.server_.listen(t,i,n,(n,i)=>{const r=s(n,i);Yn(e.eventQueue_,t._path,r)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function ei(e){const t=e.infoData_.getNode(new ue(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ti(e){return(t=(t={timestamp:ei(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function ni(e,t,n,i,s){e.dataUpdateCount++;const o=new ue(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let a=[];if(s)if(i){const t=(0,r.kH)(n,e=>it(e));a=function(e,t,n,i){const s=bn(e,i);if(s){const i=Cn(s),r=i.path,o=i.queryId,a=Ie(r,t),c=Rt.fromObject(n);return Sn(e,r,new It(yt(o),a,c))}return[]}(e.serverSyncTree_,o,t,s)}else{const t=it(n);a=function(e,t,n,i){const s=bn(e,i);if(null!=s){const i=Cn(s),r=i.path,o=i.queryId,a=Ie(r,t);return Sn(e,r,new wt(yt(o),a,n))}return[]}(e.serverSyncTree_,o,t,s)}else if(i){const t=(0,r.kH)(n,e=>it(e));a=function(e,t,n){const i=Rt.fromObject(n);return In(e,new It({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,o,t)}else{const t=it(n);a=vn(e.serverSyncTree_,o,t)}let c=o;a.length>0&&(c=hi(e,o)),Yn(e.eventQueue_,c,a)}function ii(e,t){si(e,"connected",t),!1===t&&function(e){oi(e,"onDisconnectEvents");const t=ti(e),n=dt();ft(e.onDisconnect_,de(),(i,s)=>{const r=function(e,t,n,i){return Dn(t,new An(n,e),i)}(i,s,e.serverSyncTree_,t);pt(n,i,r)});let i=[];ft(n,de(),(t,n)=>{i=i.concat(vn(e.serverSyncTree_,t,n));const s=function(e,t){const n=qn(li(e,t)),i=Ln(e.transactionQueueTree_,t);return function(e,t){let n=void 0?e:e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(i,t=>{fi(e,t)}),fi(e,i),jn(i,t=>{fi(e,t)}),n}(e,t);hi(e,s)}),e.onDisconnect_=dt(),Yn(e.eventQueue_,de(),i)}(e)}function si(e,t,n){const i=new ue("/.info/"+t),s=it(n);e.infoData_.updateSnapshot(i,s);const r=vn(e.infoSyncTree_,i,s);Yn(e.eventQueue_,i,r)}function ri(e){return e.nextWriteId_++}function oi(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),I(n,...t)}function ai(e,t,n){return wn(e.serverSyncTree_,t,n)||tt.EMPTY_NODE}function ci(e,t=e.transactionQueueTree_){if(t||pi(e,t),Mn(t)){const n=ui(e,t);(0,r.vA)(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){const i=n.map(e=>e.currentWriteId),s=ai(e,t,i);let o=s;const a=s.hash();for(let e=0;e<n.length;e++){const i=n[e];(0,r.vA)(0===i.status,"tryToSendTransactionQueue_: items in queue should all be run."),i.status=1,i.retryCount++;const s=Ie(t,i.path);o=o.updateChild(s,i.currentOutputSnapshotRaw)}const c=o.val(!0),h=t;e.server_.put(h.toString(),c,i=>{oi(e,"transaction put response",{path:h.toString(),status:i});let s=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,s=s.concat(yn(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();pi(e,Ln(e.transactionQueueTree_,t)),ci(e,e.transactionQueueTree_),Yn(e.eventQueue_,t,s);for(let e=0;e<i.length;e++)U(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{C("transaction at "+h.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}hi(e,t)}},a)}(e,qn(t),n)}else Un(t)&&Vn(t,t=>{ci(e,t)})}function hi(e,t){const n=li(e,t),i=qn(n);return function(e,t,n){if(0===t.length)return;const i=[];let s=[];const o=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let a=0;a<t.length;a++){const c=t[a],h=Ie(n,c.path);let l,u=!1;if((0,r.vA)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)u=!0,l=c.abortReason,s=s.concat(yn(e.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=25)u=!0,l="maxretry",s=s.concat(yn(e.serverSyncTree_,c.currentWriteId,!0));else{const n=ai(e,c.path,o);c.currentInputSnapshot=n;const i=t[a].update(n.val());if(void 0!==i){Kn("transaction failed: Data returned ",i,c.path);let t=it(i);"object"==typeof i&&null!=i&&(0,r.gR)(i,".priority")||(t=t.updatePriority(n.getPriority()));const a=c.currentWriteId,h=ti(e),l=On(t,n,h);c.currentOutputSnapshotRaw=t,c.currentOutputSnapshotResolved=l,c.currentWriteId=ri(e),o.splice(o.indexOf(a),1),s=s.concat(_n(e.serverSyncTree_,c.path,l,c.currentWriteId,c.applyLocally)),s=s.concat(yn(e.serverSyncTree_,a,!0))}else u=!0,l="nodata",s=s.concat(yn(e.serverSyncTree_,c.currentWriteId,!0))}Yn(e.eventQueue_,n,s),s=[],u&&(t[a].status=2,function(e){setTimeout(e,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&("nodata"===l?i.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):i.push(()=>t[a].onComplete(new Error(l),!1,null))))}pi(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)U(i[e]);ci(e,e.transactionQueueTree_)}(e,ui(e,n),i),i}function li(e,t){let n,i=e.transactionQueueTree_;for(n=pe(t);null!==n&&void 0===Mn(i);)i=Ln(i,n),n=pe(t=ge(t));return i}function ui(e,t){const n=[];return di(e,t,n),n.sort((e,t)=>e.order-t.order),n}function di(e,t,n){const i=Mn(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);Vn(t,t=>{di(e,t,n)})}function pi(e,t){const n=Mn(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Fn(t,n.length>0?n:void 0)}Vn(t,t=>{pi(e,t)})}function fi(e,t){const n=Mn(t);if(n){const i=[];let s=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,r.vA)(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):((0,r.vA)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),s=s.concat(yn(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Fn(t,void 0):n.length=o+1,Yn(e.eventQueue_,qn(t),s);for(let e=0;e<i.length;e++)U(i[e])}}const gi=function(e,t){const n=mi(e),i=n.namespace;"firebase.com"===n.domain&&b(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||b("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&C("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new G(n.host,n.secure,i,s,t,"",i!==n.subdomain),path:new ue(n.pathString)}},mi=function(e){let t="",n="",i="",s="",r="",o=!0,a="https",c=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let l=e.indexOf("/");-1===l&&(l=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(l,u)),l<u&&(s=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(l,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):C(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));h=t.indexOf(":"),h>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(h+1),10)):h=t.length;const p=t.slice(0,h);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),r=i}"ns"in d&&(r=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class _i{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return we(this._path)?null:me(this._path)}get ref(){return new yi(this._repo,this._path)}get _queryIdentifier(){const e=ht(this._queryParams),t=O(e);return"{}"===t?"default":t}get _queryObject(){return ht(this._queryParams)}isEqual(e){if(!((e=(0,r.Ku)(e))instanceof _i))return!1;const t=this._repo===e._repo,n=Ee(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class yi extends _i{constructor(e,t){super(e,t,new at,!1)}get parent(){const e=ye(this._path);return null===e?null:new yi(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}!function(e){(0,r.vA)(!dn,"__referenceConstructor has already been defined"),dn=e}(yi),function(e){(0,r.vA)(!pn,"__referenceConstructor has already been defined"),pn=e}(yi);const vi={};class wi{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Zn(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new yi(this._repo,de())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=vi[t];n&&n[e.key]===e||b(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&b("Cannot call "+e+" on a deleted database.")}}function Ii(e=(0,i.Sx)(),t){const n=(0,i.j6)(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=(0,r.yU)("database");e&&function(e,t,n,i={}){(e=(0,r.Ku)(e))._checkNotDeleted("useEmulator");const s=`${t}:${n}`,o=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&(0,r.bD)(i,o.repoInfo_.emulatorOptions))return;b("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&b('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new B(B.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:(0,r.Fy)(i.mockUserToken,e.app.options.projectId);a=new B(t)}(0,r.zJ)(t)&&((0,r.gE)(t),(0,r.P1)("Database",!0)),function(e,t,n,i){const s=t.lastIndexOf(":"),o=t.substring(0,s),a=(0,r.zJ)(o);e.repoInfo_=new G(t,a,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(e.authTokenProvider_=i)}(o,s,i,a)}(n,...e)}return n}Ne.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Ne.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){h=e}(i.MF),(0,i.om)(new s.uA("database",(e,{instanceIdentifier:t})=>function(e,t,n,i,s){let r=i||e.options.databaseURL;void 0===r&&(e.options.projectId||b("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),I("Using default host for project ",e.options.projectId),r=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=gi(r,s),h=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,r=`http://${a}?ns=${h.namespace}`,c=gi(r,s),h=c.repoInfo):o=!c.repoInfo.secure;const l=s&&o?new B(B.OWNER):new q(e.name,e.options,t);Gn("Invalid Firebase Database URL",c),we(c.path)||b("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let s=vi[t.name];s||(s={},vi[t.name]=s);let r=s[e.toURLString()];return r&&b("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Xn(e,!1,n,i),s[e.toURLString()]=r,r}(h,e,l,new j(e,n));return new wi(u,e)}(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(a,c,undefined),(0,i.KO)(a,c,"esm2020")},500:(e,t,n)=>{n.d(t,{r:()=>d,w:()=>f});const i=(e,t)=>t.some(t=>e instanceof t);let s,r;const o=new WeakMap,a=new WeakMap,c=new WeakMap,h=new WeakMap,l=new WeakMap;let u={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){u=e(u)}function p(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(g(this),e),f(o.get(this))}:function(...e){return f(t.apply(g(this),e))}:function(e,...n){const i=t.call(g(this),e,...n);return c.set(i,e.sort?e.sort():[e]),f(i)}:(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)});a.set(e,t)}(e),i(e,s||(s=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,u):e);var t}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(f(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)});return t.then(t=>{t instanceof IDBCursor&&o.set(t,e)}).catch(()=>{}),l.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=p(e);return t!==e&&(h.set(e,t),l.set(t,e)),t}const g=e=>l.get(e)},542:(e,t,n)=>{n.d(t,{D:()=>et,ac:()=>Xe,p:()=>dn,z:()=>Ze});var i=n(943),s=n(625),r=n(722),o=n(711);const a=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},c=new s.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),h=new r.Vy("@firebase/auth");function l(e,...t){h.logLevel<=r.$b.ERROR&&h.error(`Auth (${i.MF}): ${e}`,...t)}function u(e,...t){throw g(e,...t)}function d(e,...t){return g(e,...t)}function p(e,t,n){const i={...a(),[t]:n};return new s.FA("auth","Firebase",i).create(t,{appName:e.name})}function f(e){return p(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function g(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return c.create(e,...t)}function m(e,t,...n){if(!e)throw g(t,...n)}function _(e){const t="INTERNAL ASSERTION FAILED: "+e;throw l(t),new Error(t)}function y(e,t){e||_(t)}function v(){return"undefined"!=typeof self&&self.location?.href||""}function w(){return"undefined"!=typeof self&&self.location?.protocol||null}class I{constructor(e,t){this.shortDelay=e,this.longDelay=t,y(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,s.jZ)()||(0,s.lV)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===w()||"https:"===w()||(0,s.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function E(e,t){y(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class T{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void _("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void _("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void _("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const b={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},C=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],S=new I(3e4,6e4);function k(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function A(e,t,n,i,r={}){return N(e,r,async()=>{let r={},o={};i&&("GET"===t?o=i:r={body:JSON.stringify(i)});const a=(0,s.Am)({key:e.config.apiKey,...o}).slice(1),c=await e._getAdditionalHeaders();c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode);const h={method:t,headers:c,...r};return(0,s.c1)()||(h.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,s.zJ)(e.emulatorConfig.host)&&(h.credentials="include"),T.fetch()(await P(e,e.config.apiHost,n,a),h)})}async function N(e,t,n){e._canInitEmulator=!1;const i={...b,...t};try{const t=new D(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw x(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw x(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw x(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw x(e,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw p(e,a,o);u(e,a)}}catch(t){if(t instanceof s.g)throw t;u(e,"network-request-failed",{message:String(t)})}}async function R(e,t,n,i,s={}){const r=await A(e,t,n,i,s);return"mfaPendingCredential"in r&&u(e,"multi-factor-auth-required",{_serverResponse:r}),r}async function P(e,t,n,i){const s=`${t}${n}?${i}`,r=e,o=r.config.emulator?E(e.config,s):`${e.config.apiScheme}://${s}`;return C.includes(n)&&(await r._persistenceManagerAvailable,"COOKIE"===r._getPersistenceType())?r._getPersistence()._getFinalTarget(o).toString():o}function O(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class D{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(d(this.auth,"network-request-failed")),S.get())})}}function x(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=d(e,t,i);return s.customData._tokenResponse=n,s}function L(e){return void 0!==e&&void 0!==e.enterprise}class M{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return O(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function F(e,t){return A(e,"GET","/v2/recaptchaConfig",k(e,t))}async function U(e,t){return A(e,"POST","/v1/accounts:lookup",t)}function V(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function j(e){return 1e3*Number(e)}function q(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return l("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,s.u)(n);return e?JSON.parse(e):(l("Failed to decode base64 JWT payload"),null)}catch(e){return l("Caught error parsing JWT payload as JSON",e?.toString()),null}}function B(e){const t=q(e);return m(t,"internal-error"),m(void 0!==t.exp,"internal-error"),m(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function H(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof s.g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class W{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class ${constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=V(this.lastLoginAt),this.creationTime=V(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function z(e){const t=e.auth,n=await e.getIdToken(),i=await H(e,U(t,{idToken:n}));m(i?.users.length,t,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const r=s.providerUserInfo?.length?K(s.providerUserInfo):[],o=(a=e.providerData,c=r,[...a.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var a,c;const h=e.isAnonymous,l=!(e.email&&s.passwordHash||o?.length),u=!!h&&l,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new $(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(e,d)}function K(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}class G{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){m(e.idToken,"internal-error"),m(void 0!==e.idToken,"internal-error"),m(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):B(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){m(0!==e.length,"internal-error");const t=B(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(m(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await N(e,{},async()=>{const n=(0,s.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,o=await P(e,i,"/v1/token",`key=${r}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:n};return e.emulatorConfig&&(0,s.zJ)(e.emulatorConfig.host)&&(c.credentials="include"),T.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new G;return n&&(m("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(m("string"==typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(m("number"==typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new G,this.toJSON())}_performRefresh(){return _("not implemented")}}function Q(e,t){m("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Y{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new W(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new $(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await H(this,this.stsTokenManager.getToken(this.auth,e));return m(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,s.Ku)(e),i=await n.getIdToken(t),r=q(i);m(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const o="object"==typeof r.firebase?r.firebase:void 0,a=o?.sign_in_provider;return{claims:r,token:i,authTime:V(j(r.auth_time)),issuedAtTime:V(j(r.iat)),expirationTime:V(j(r.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=(0,s.Ku)(e);await z(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(m(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Y({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){m(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await z(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,i.xZ)(this.auth.app))return Promise.reject(f(this.auth));const e=await this.getIdToken();return await H(this,async function(e,t){return A(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,r=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,c=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:l,emailVerified:u,isAnonymous:d,providerData:p,stsTokenManager:f}=t;m(l&&f,e,"internal-error");const g=G.fromJSON(this.name,f);m("string"==typeof l,e,"internal-error"),Q(n,e.name),Q(i,e.name),m("boolean"==typeof u,e,"internal-error"),m("boolean"==typeof d,e,"internal-error"),Q(s,e.name),Q(r,e.name),Q(o,e.name),Q(a,e.name),Q(c,e.name),Q(h,e.name);const _=new Y({uid:l,auth:e,email:i,emailVerified:u,displayName:n,isAnonymous:d,photoURL:r,phoneNumber:s,tenantId:o,stsTokenManager:g,createdAt:c,lastLoginAt:h});return p&&Array.isArray(p)&&(_.providerData=p.map(e=>({...e}))),a&&(_._redirectEventId=a),_}static async _fromIdTokenResponse(e,t,n=!1){const i=new G;i.updateFromServerResponse(t);const s=new Y({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await z(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];m(void 0!==i.localId,"internal-error");const s=void 0!==i.providerUserInfo?K(i.providerUserInfo):[],r=!(i.email&&i.passwordHash||s?.length),o=new G;o.updateFromIdToken(n);const a=new Y({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:r}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new $(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||s?.length)};return Object.assign(a,c),a}}const J=new Map;function X(e){y(e instanceof Function,"Expected a class definition");let t=J.get(e);return t?(y(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,J.set(e,t),t)}class Z{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Z.type="NONE";const ee=Z;function te(e,t,n){return`firebase:${e}:${t}:${n}`}class ne{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=te(this.userKey,i.apiKey,s),this.fullPersistenceKey=te("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await U(this.auth,{idToken:e}).catch(()=>{});return t?Y._fromGetAccountInfoResponse(this.auth,t,e):null}return Y._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ne(X(ee),e,n);const i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=i[0]||X(ee);const r=te(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(r);if(t){let i;if("string"==typeof t){const n=await U(e,{idToken:t}).catch(()=>{});if(!n)break;i=await Y._fromGetAccountInfoResponse(e,n,t)}else i=Y._fromJSON(e,t);n!==s&&(o=i),s=n;break}}catch{}const a=i.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(r)}catch{}})),new ne(s,e,n)):new ne(s,e,n)}}function ie(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ae(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(se(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(he(t))return"Blackberry";if(le(t))return"Webos";if(re(t))return"Safari";if((t.includes("chrome/")||oe(t))&&!t.includes("edge/"))return"Chrome";if(ce(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function se(e=(0,s.ZQ)()){return/firefox\//i.test(e)}function re(e=(0,s.ZQ)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function oe(e=(0,s.ZQ)()){return/crios\//i.test(e)}function ae(e=(0,s.ZQ)()){return/iemobile/i.test(e)}function ce(e=(0,s.ZQ)()){return/android/i.test(e)}function he(e=(0,s.ZQ)()){return/blackberry/i.test(e)}function le(e=(0,s.ZQ)()){return/webos/i.test(e)}function ue(e=(0,s.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function de(e=(0,s.ZQ)()){return ue(e)||ce(e)||le(e)||he(e)||/windows phone/i.test(e)||ae(e)}function pe(e,t=[]){let n;switch(e){case"Browser":n=ie((0,s.ZQ)());break;case"Worker":n=`${ie((0,s.ZQ)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${i.MF}/${r}`}class fe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,i)=>{try{n(e(t))}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}class ge{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class me{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ye(this),this.idTokenSubscription=new ye(this),this.beforeStateQueue=new fe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=X(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ne.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await U(this,{idToken:e}),n=await Y._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,i.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,i=n?._redirectEventId,r=await this.tryRedirectSignIn(e);t&&t!==i||!r?.user||(n=r.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return m(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await z(e)}catch(e){if("auth/network-request-failed"!==e?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,i.xZ)(this.app))return Promise.reject(f(this));const t=e?(0,s.Ku)(e):null;return t&&m(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&m(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,i.xZ)(this.app)?Promise.reject(f(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,i.xZ)(this.app)?Promise.reject(f(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(X(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return A(e,"GET","/v2/passwordPolicy",k(e,t))}(this),t=new ge(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new s.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return A(e,"POST","/v2/accounts:revokeToken",k(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&X(e)||this._popupRedirectResolver;m(t,this,"argument-error"),this.redirectPersistenceManager=await ne.create(this,[X(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let r=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(m(o,this,"internal-error"),o.then(()=>{r||s(this.currentUser)}),"function"==typeof t){const s=e.addObserver(t,n,i);return()=>{r=!0,s()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return m(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pe(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if((0,i.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e,...t){h.logLevel<=r.$b.WARN&&h.warn(`Auth (${i.MF}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function _e(e){return(0,s.Ku)(e)}class ye{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,s.tD)(e=>this.observer=e)}get next(){return m(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ve={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function we(e){return ve.loadJS(e)}function Ie(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Ee{constructor(){this.enterprise=new Te}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Te{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const be="NO_RECAPTCHA";class Ce{constructor(e){this.type="recaptcha-enterprise",this.auth=_e(e)}async verify(e="verify",t=!1){function n(t,n,i){const s=window.grecaptcha;L(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(be)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Ee).execute("siteKey",{action:"verify"}):new Promise((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{F(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new M(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&L(window.grecaptcha))n(s,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=ve.recaptchaEnterpriseScript;0!==t.length&&(t+=s),we(t).then(()=>{n(s,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function Se(e,t,n,i=!1,s=!1){const r=new Ce(e);let o;if(s)o=be;else try{o=await r.verify(n)}catch(e){o=await r.verify(n,!0)}const a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function ke(e,t,n,i,s){if("EMAIL_PASSWORD_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Se(e,t,n,"getOobCode"===n);return i(e,s)}return i(e,t).catch(async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Se(e,t,n,"getOobCode"===n);return i(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const s=await Se(e,t,n);return i(e,s).catch(async s=>{if("AUDIT"===e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const s=await Se(e,t,n,!1,!0);return i(e,s)}return Promise.reject(s)})}{const s=await Se(e,t,n,!1,!0);return i(e,s)}}return Promise.reject(s+" provider is not supported.")}function Ae(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ne(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Re{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return _("not implemented")}_getIdTokenResponse(e){return _("not implemented")}_linkToIdToken(e,t){return _("not implemented")}_getReauthenticationResolver(e){return _("not implemented")}}async function Pe(e,t){return A(e,"POST","/v1/accounts:signUp",t)}async function Oe(e,t){return R(e,"POST","/v1/accounts:signInWithPassword",k(e,t))}class De extends Re{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new De(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new De(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ke(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Oe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return R(e,"POST","/v1/accounts:signInWithEmailLink",k(e,t))}(e,{email:this._email,oobCode:this._password});default:u(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ke(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Pe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return R(e,"POST","/v1/accounts:signInWithEmailLink",k(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:u(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function xe(e,t){return R(e,"POST","/v1/accounts:signInWithIdp",k(e,t))}class Le extends Re{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Le(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):u("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i,...s}=t;if(!n||!i)return null;const r=new Le(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return xe(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,xe(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,xe(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,s.Am)(t)}return e}}async function Me(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",k(e,t))}const Fe={USER_NOT_FOUND:"user-not-found"};class Ue extends Re{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ue({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ue({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return R(e,"POST","/v1/accounts:signInWithPhoneNumber",k(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await R(e,"POST","/v1/accounts:signInWithPhoneNumber",k(e,t));if(n.temporaryProof)throw x(e,"account-exists-with-different-credential",n);return n}(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return async function(e,t){return R(e,"POST","/v1/accounts:signInWithPhoneNumber",k(e,{...t,operation:"REAUTH"}),Fe)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new Ue({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class Ve{constructor(e){const t=(0,s.I9)((0,s.hp)(e)),n=t.apiKey??null,i=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);m(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=(0,s.I9)((0,s.hp)(e)).link,n=t?(0,s.I9)((0,s.hp)(t)).deep_link_id:null,i=(0,s.I9)((0,s.hp)(e)).deep_link_id;return(i?(0,s.I9)((0,s.hp)(i)).link:null)||i||n||t||e}(e);try{return new Ve(t)}catch{return null}}}class je{constructor(){this.providerId=je.PROVIDER_ID}static credential(e,t){return De._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ve.parseLink(t);return m(n,"argument-error"),De._fromEmailAndCode(e,n.code,n.tenantId)}}je.PROVIDER_ID="password",je.EMAIL_PASSWORD_SIGN_IN_METHOD="password",je.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class qe{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Be extends qe{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class He extends Be{constructor(){super("facebook.com")}static credential(e){return Le._fromParams({providerId:He.PROVIDER_ID,signInMethod:He.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return He.credentialFromTaggedObject(e)}static credentialFromError(e){return He.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return He.credential(e.oauthAccessToken)}catch{return null}}}He.FACEBOOK_SIGN_IN_METHOD="facebook.com",He.PROVIDER_ID="facebook.com";class We extends Be{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Le._fromParams({providerId:We.PROVIDER_ID,signInMethod:We.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return We.credentialFromTaggedObject(e)}static credentialFromError(e){return We.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return We.credential(t,n)}catch{return null}}}We.GOOGLE_SIGN_IN_METHOD="google.com",We.PROVIDER_ID="google.com";class $e extends Be{constructor(){super("github.com")}static credential(e){return Le._fromParams({providerId:$e.PROVIDER_ID,signInMethod:$e.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $e.credentialFromTaggedObject(e)}static credentialFromError(e){return $e.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return $e.credential(e.oauthAccessToken)}catch{return null}}}$e.GITHUB_SIGN_IN_METHOD="github.com",$e.PROVIDER_ID="github.com";class ze extends Be{constructor(){super("twitter.com")}static credential(e,t){return Le._fromParams({providerId:ze.PROVIDER_ID,signInMethod:ze.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ze.credentialFromTaggedObject(e)}static credentialFromError(e){return ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ze.credential(t,n)}catch{return null}}}ze.TWITTER_SIGN_IN_METHOD="twitter.com",ze.PROVIDER_ID="twitter.com";class Ke{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await Y._fromIdTokenResponse(e,n,i),r=Ge(n);return new Ke({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=Ge(n);return new Ke({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function Ge(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Qe extends s.g{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Qe.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Qe(e,t,n,i)}}function Ye(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Qe._fromErrorAndOperation(e,n,t,i);throw n})}async function Je(e,t,n=!1){if((0,i.xZ)(e.app))return Promise.reject(f(e));const s="signIn",r=await Ye(e,s,t),o=await Ke._fromIdTokenResponse(e,s,r);return n||await e._updateCurrentUser(o.user),o}function Xe(e,t,n){return(0,i.xZ)(e.app)?Promise.reject(f(e)):async function(e,t){return Je(_e(e),t)}((0,s.Ku)(e),je.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&async function(e){const t=_e(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}(e),t})}function Ze(e,t,n,i){return(0,s.Ku)(e).onAuthStateChanged(t,n,i)}function et(e){return(0,s.Ku)(e).signOut()}function tt(e,t){return A(e,"POST","/v2/accounts/mfaEnrollment:start",k(e,t))}new WeakMap;const nt="__sak";class it{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(nt,"1"),this.storage.removeItem(nt),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class st extends it{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=de(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);(0,s.lT)()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}st.type="LOCAL";const rt=st;class ot extends it{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ot.type="SESSION";const at=ot;class ct{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new ct(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!r?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function ht(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ct.receivers=[];class lt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise((o,a)=>{const c=ht("",20);i.port1.start();const h=setTimeout(()=>{a(new Error("unsupported_event"))},n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(h),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function ut(){return window}function dt(){return void 0!==ut().WorkerGlobalScope&&"function"==typeof ut().importScripts}const pt="firebaseLocalStorageDb",ft="firebaseLocalStorage",gt="fbase_key";class mt{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function _t(e,t){return e.transaction([ft],t?"readwrite":"readonly").objectStore(ft)}function yt(){const e=indexedDB.open(pt,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ft,{keyPath:gt})}catch(e){n(e)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ft)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(pt);return new mt(e).toPromise()}(),t(await yt()))})})}async function vt(e,t,n){const i=_t(e,!0).put({[gt]:t,value:n});return new mt(i).toPromise()}function wt(e,t){const n=_t(e,!0).delete(t);return new mt(n).toPromise()}class It{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await yt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return dt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ct._getInstance(dt()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new lt(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yt();return await vt(e,nt,"1"),await wt(e,nt),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>vt(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=_t(e,!1).get(t),i=await new mt(n).toPromise();return void 0===i?null:i.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>wt(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=_t(e,!1).getAll();return new mt(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}It.type="LOCAL";const Et=It;function Tt(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:start",k(e,t))}Ie("rcb"),new I(3e4,6e4);const bt="recaptcha";async function Ct(e,t,n){if(!e._getRecaptchaConfig())try{await async function(e){const t=_e(e),n=await F(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new M(n);null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,i.isAnyProviderEnabled()&&new Ce(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){m("enroll"===t.type,e,"internal-error");const s=ke(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===be?(m(n?.type===bt,e,"argument-error"),tt(e,await St(e,t,n))):tt(e,t),"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{m("signin"===t.type,e,"internal-error");const s=i.multiFactorHint?.uid||i.multiFactorUid;m(s,e,"missing-multi-factor-info");const r=ke(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===be?(m(n?.type===bt,e,"argument-error"),Tt(e,await St(e,t,n))):Tt(e,t),"PHONE_PROVIDER");return(await r.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t=ke(e,{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(e,t)=>t.captchaResponse===be?(m(n?.type===bt,e,"argument-error"),Me(e,await St(e,t,n))):Me(e,t),"PHONE_PROVIDER");return(await t.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function St(e,t,n){m(n.type===bt,e,"argument-error");const i=await n.verify();m("string"==typeof i,e,"argument-error");const s={...t};if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,r=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:r}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:i}),s}class kt{constructor(e){this.providerId=kt.PROVIDER_ID,this.auth=_e(e)}verifyPhoneNumber(e,t){return Ct(this.auth,e,(0,s.Ku)(t))}static credential(e,t){return Ue._fromVerification(e,t)}static credentialFromResult(e){const t=e;return kt.credentialFromTaggedObject(t)}static credentialFromError(e){return kt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ue._fromTokenResponse(t,n):null}}kt.PROVIDER_ID="phone",kt.PHONE_SIGN_IN_METHOD="phone";class At extends Re{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return xe(e,this._buildIdpRequest())}_linkToIdToken(e,t){return xe(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return xe(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Nt(e){return Je(e.auth,new At(e),e.bypassAuthState)}function Rt(e){const{auth:t,user:n}=e;return m(n,t,"internal-error"),async function(e,t,n=!1){const{auth:s}=e;if((0,i.xZ)(s.app))return Promise.reject(f(s));const r="reauthenticate";try{const i=await H(e,Ye(s,r,t,e),n);m(i.idToken,s,"internal-error");const o=q(i.idToken);m(o,s,"internal-error");const{sub:a}=o;return m(e.uid===a,s,"user-mismatch"),Ke._forOperation(e,r,i)}catch(e){throw"auth/user-not-found"===e?.code&&u(s,"user-mismatch"),e}}(n,new At(e),e.bypassAuthState)}async function Pt(e){const{auth:t,user:n}=e;return m(n,t,"internal-error"),async function(e,t,n=!1){const i=await H(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Ke._forOperation(e,"link",i)}(n,new At(e),e.bypassAuthState)}class Ot{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Nt;case"linkViaPopup":case"linkViaRedirect":return Pt;case"reauthViaPopup":case"reauthViaRedirect":return Rt;default:u(this.auth,"internal-error")}}resolve(e){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Dt=new I(2e3,1e4);class xt extends Ot{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,xt.currentPopupAction&&xt.currentPopupAction.cancel(),xt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return m(e,this.auth,"internal-error"),e}async onExecution(){y(1===this.filter.length,"Popup operations only handle one event");const e=ht();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(d(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(d(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xt.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(d(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Dt.get())};e()}}xt.currentPopupAction=null;const Lt=new Map;class Mt extends Ot{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Lt.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return te("pendingRedirect",e.config.apiKey,e.name)}(t),i=function(e){return X(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Lt.set(this.auth._key(),e)}return this.bypassAuthState||Lt.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ft(e,t){Lt.set(e._key(),t)}async function Ut(e,t,n=!1){if((0,i.xZ)(e.app))return Promise.reject(f(e));const s=_e(e),r=function(e,t){return t?X(t):(m(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(s,t),o=new Mt(s,r,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,t)),a}class Vt{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return qt(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!qt(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(d(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(jt(e))}saveEventToCache(e){this.cachedEventUids.add(jt(e)),this.lastProcessedEventTime=Date.now()}}function jt(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function qt({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===t?.code}const Bt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ht=/^https?/;function Wt(e){const t=v(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!Ht.test(n))return!1;if(Bt.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const $t=new I(3e4,6e4);function zt(){const e=ut().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Kt(e){return new Promise((t,n)=>{function i(){zt(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{zt(),n(d(e,"network-request-failed"))},timeout:$t.get()})}if(ut().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!ut().gapi?.load){const t=Ie("iframefcb");return ut()[t]=()=>{gapi.load?i():n(d(e,"network-request-failed"))},we(`${ve.gapiScript}?onload=${t}`).catch(e=>n(e))}i()}}).catch(e=>{throw Gt=null,e})}let Gt=null;const Qt=new I(5e3,15e3),Yt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Jt=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Xt(e){const t=e.config;m(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?E(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:i.MF},o=Jt.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,s.Am)(r).slice(1)}`}const Zt={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class en{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const tn=encodeURIComponent("fac");async function nn(e,t,n,r,o,a){m(e.config.authDomain,e,"auth-domain-config-required"),m(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:i.MF,eventId:o};if(t instanceof qe){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,s.Im)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof Be){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const h=c;for(const e of Object.keys(h))void 0===h[e]&&delete h[e];const l=await e._getAppCheckToken(),u=l?`#${tn}=${encodeURIComponent(l)}`:"";return`${function({config:e}){return e.emulator?E(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,s.Am)(h).slice(1)}${u}`}const sn="webStorageSupport",rn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=at,this._completeRedirectFn=Ut,this._overrideRedirectResult=Ft}async _openPopup(e,t,n,i){return y(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,r=600){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const h={...Zt,width:i.toString(),height:r.toString(),top:o,left:a},l=(0,s.ZQ)().toLowerCase();n&&(c=oe(l)?"_blank":n),se(l)&&(t=t||"http://localhost",h.scrollbars="yes");const u=Object.entries(h).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,s.ZQ)()){return ue(e)&&!!window.navigator?.standalone}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",c),new en(null);const d=window.open(t||"",c,u);m(d,e,"popup-blocked");try{d.focus()}catch(e){}return new en(d)}(e,await nn(e,t,n,v(),i),ht())}async _openRedirect(e,t,n,i){return await this._originValidation(e),s=await nn(e,t,n,v(),i),ut().location.href=s,new Promise(()=>{});var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(y(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Gt=Gt||Kt(e),Gt}(e),n=ut().gapi;return m(n,e,"internal-error"),t.open({where:document.body,url:Xt(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yt,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=d(e,"network-request-failed"),r=ut().setTimeout(()=>{i(s)},Qt.get());function o(){ut().clearTimeout(r),n(t)}t.ping(o).then(o,()=>{i(s)})}))}(e),n=new Vt(e);return t.register("authEvent",t=>(m(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(sn,{type:sn},n=>{const i=n?.[0]?.[sn];void 0!==i&&t(!!i),u(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return A(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Wt(e))return}catch{}u(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return de()||re()||ue()}};var on="@firebase/auth",an="1.11.0";class cn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){m(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const hn=(0,s.XA)("authIdTokenMaxAge")||300;let ln=null;const un=e=>async t=>{const n=t&&await t.getIdTokenResult(),i=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>hn)return;const s=n?.token;ln!==s&&(ln=s,await fetch(e,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function dn(e=(0,i.Sx)()){const t=(0,i.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,i.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),i=n.getOptions();if((0,s.bD)(i,t??{}))return e;u(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:rn,persistence:[Et,rt,at]}),r=(0,s.XA)("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=un(e.toString());!function(e,t,n){(0,s.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e){(0,s.Ku)(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(n)}}const o=(0,s.Tj)("auth");return o&&function(e,t,n){const i=_e(e);m(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!n?.disableWarnings,o=Ae(t),{host:a,port:c}=function(e){const t=Ae(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:Ne(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Ne(t)}}}(t),h=null===c?"":`:${c}`,l={url:`${o}//${a}${h}/`},u=Object.freeze({host:a,port:c,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator)return m(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),void m((0,s.bD)(l,i.config.emulator)&&(0,s.bD)(u,i.emulatorConfig),i,"emulator-config-failed");i.config.emulator=l,i.emulatorConfig=u,i.settings.appVerificationDisabledForTesting=!0,(0,s.zJ)(a)?((0,s.gE)(`${o}//${a}${h}`),(0,s.P1)("Auth",!0)):r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${o}`),n}var pn;ve={loadJS:e=>new Promise((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=d("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},pn="Browser",(0,i.om)(new o.uA("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:r,authDomain:o}=n.options;m(r&&!r.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:r,authDomain:o,clientPlatform:pn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pe(pn)},c=new me(n,i,s,a);return function(e,t){const n=t?.persistence||[],i=(Array.isArray(n)?n:[n]).map(X);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,t?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,i.om)(new o.uA("auth-internal",e=>{return t=_e(e.getProvider("auth").getImmediate()),new cn(t);var t},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,i.KO)(on,an,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(pn)),(0,i.KO)(on,an,"esm2020")},589:(e,t,n)=>{n.d(t,{aU:()=>gs});var i,s=n(943),r=n(711),o=n(722),a=n(625),c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const i=Array(16);if("string"==typeof t)for(var s=0;s<16;++s)i[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;s<16;++s)i[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];let r,o=e.g[3];r=t+(o^n&(s^o))+i[0]+3614090360&4294967295,r=o+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[1]+3905402710&4294967295,o=t+(r<<12&4294967295|r>>>20),r=s+(n^o&(t^n))+i[2]+606105819&4294967295,r=n+(t^(s=o+(r<<17&4294967295|r>>>15))&(o^t))+i[3]+3250441966&4294967295,r=t+(o^(n=s+(r<<22&4294967295|r>>>10))&(s^o))+i[4]+4118548399&4294967295,r=o+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[5]+1200080426&4294967295,o=t+(r<<12&4294967295|r>>>20),r=s+(n^o&(t^n))+i[6]+2821735955&4294967295,r=n+(t^(s=o+(r<<17&4294967295|r>>>15))&(o^t))+i[7]+4249261313&4294967295,r=t+(o^(n=s+(r<<22&4294967295|r>>>10))&(s^o))+i[8]+1770035416&4294967295,r=o+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[9]+2336552879&4294967295,o=t+(r<<12&4294967295|r>>>20),r=s+(n^o&(t^n))+i[10]+4294925233&4294967295,r=n+(t^(s=o+(r<<17&4294967295|r>>>15))&(o^t))+i[11]+2304563134&4294967295,r=t+(o^(n=s+(r<<22&4294967295|r>>>10))&(s^o))+i[12]+1804603682&4294967295,r=o+(s^(t=n+(r<<7&4294967295|r>>>25))&(n^s))+i[13]+4254626195&4294967295,o=t+(r<<12&4294967295|r>>>20),r=s+(n^o&(t^n))+i[14]+2792965006&4294967295,r=n+(t^(s=o+(r<<17&4294967295|r>>>15))&(o^t))+i[15]+1236535329&4294967295,r=t+(s^o&((n=s+(r<<22&4294967295|r>>>10))^s))+i[1]+4129170786&4294967295,r=o+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[6]+3225465664&4294967295,o=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(o^t))+i[11]+643717713&4294967295,r=n+(o^t&((s=o+(r<<14&4294967295|r>>>18))^o))+i[0]+3921069994&4294967295,r=t+(s^o&((n=s+(r<<20&4294967295|r>>>12))^s))+i[5]+3593408605&4294967295,r=o+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[10]+38016083&4294967295,o=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(o^t))+i[15]+3634488961&4294967295,r=n+(o^t&((s=o+(r<<14&4294967295|r>>>18))^o))+i[4]+3889429448&4294967295,r=t+(s^o&((n=s+(r<<20&4294967295|r>>>12))^s))+i[9]+568446438&4294967295,r=o+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[14]+3275163606&4294967295,o=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(o^t))+i[3]+4107603335&4294967295,r=n+(o^t&((s=o+(r<<14&4294967295|r>>>18))^o))+i[8]+1163531501&4294967295,r=t+(s^o&((n=s+(r<<20&4294967295|r>>>12))^s))+i[13]+2850285829&4294967295,r=o+(n^s&((t=n+(r<<5&4294967295|r>>>27))^n))+i[2]+4243563512&4294967295,o=t+(r<<9&4294967295|r>>>23),r=s+(t^n&(o^t))+i[7]+1735328473&4294967295,r=n+(o^t&((s=o+(r<<14&4294967295|r>>>18))^o))+i[12]+2368359562&4294967295,r=t+((n=s+(r<<20&4294967295|r>>>12))^s^o)+i[5]+4294588738&4294967295,r=o+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[8]+2272392833&4294967295,o=t+(r<<11&4294967295|r>>>21),r=s+(o^t^n)+i[11]+1839030562&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^t)+i[14]+4259657740&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^o)+i[1]+2763975236&4294967295,r=o+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[4]+1272893353&4294967295,o=t+(r<<11&4294967295|r>>>21),r=s+(o^t^n)+i[7]+4139469664&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^t)+i[10]+3200236656&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^o)+i[13]+681279174&4294967295,r=o+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[0]+3936430074&4294967295,o=t+(r<<11&4294967295|r>>>21),r=s+(o^t^n)+i[3]+3572445317&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^t)+i[6]+76029189&4294967295,r=t+((n=s+(r<<23&4294967295|r>>>9))^s^o)+i[9]+3654602809&4294967295,r=o+((t=n+(r<<4&4294967295|r>>>28))^n^s)+i[12]+3873151461&4294967295,o=t+(r<<11&4294967295|r>>>21),r=s+(o^t^n)+i[15]+530742520&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^t)+i[2]+3299628645&4294967295,r=t+(s^((n=s+(r<<23&4294967295|r>>>9))|~o))+i[0]+4096336452&4294967295,r=o+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[7]+1126891415&4294967295,o=t+(r<<10&4294967295|r>>>22),r=s+(t^(o|~n))+i[14]+2878612391&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~t))+i[5]+4237533241&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~o))+i[12]+1700485571&4294967295,r=o+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[3]+2399980690&4294967295,o=t+(r<<10&4294967295|r>>>22),r=s+(t^(o|~n))+i[10]+4293915773&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~t))+i[1]+2240044497&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~o))+i[8]+1873313359&4294967295,r=o+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[15]+4264355552&4294967295,o=t+(r<<10&4294967295|r>>>22),r=s+(t^(o|~n))+i[6]+2734768916&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~t))+i[13]+1309151649&4294967295,r=t+(s^((n=s+(r<<21&4294967295|r>>>11))|~o))+i[4]+4149444226&4294967295,r=o+(n^((t=n+(r<<6&4294967295|r>>>26))|~s))+i[11]+3174756917&4294967295,o=t+(r<<10&4294967295|r>>>22),r=s+(t^(o|~n))+i[2]+718787259&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(r<<21&4294967295|r>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+o&4294967295}function s(e,t){this.h=t;const n=[];let i=!0;for(let s=e.length-1;s>=0;s--){const r=0|e[s];i&&r==t||(n[s]=r,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const i=t-this.blockSize,s=this.C;let r=this.h,o=0;for(;o<t;){if(0==r)for(;o<=i;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[r++]=e.charCodeAt(o++),r==this.blockSize){n(this,s),r=0;break}}else for(;o<t;)if(s[r++]=e[o++],r==this.blockSize){n(this,s),r=0;break}}this.h=r,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let i=0;i<32;i+=8)e[t++]=this.g[n]>>>i&255;return e};var r={};function o(e){return-128<=e&&e<128?function(e){var t=r;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new s([0|e],e<0?-1:0)}(e)}(e):new s([0|e],e<0?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return f(a(-e));const t=[];let n=1;for(let i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new s(t,0)}var c=o(0),l=o(1),u=o(16777216);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return-1==e.h}function f(e){const t=e.g.length,n=[];for(let i=0;i<t;i++)n[i]=~e.g[i];return new s(n,~e.h).add(l)}function g(e,t){return e.add(f(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function _(e,t){this.g=e,this.h=t}function y(e,t){if(d(t))throw Error("division by zero");if(d(e))return new _(c,c);if(p(e))return t=y(f(e),t),new _(f(t.g),f(t.h));if(p(t))return t=y(e,f(t)),new _(f(t.g),t.h);if(e.g.length>30){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,i=t;i.l(e)<=0;)n=v(n),i=v(i);var s=w(n,1),r=w(i,1);for(i=w(i,2),n=w(n,2);!d(i);){var o=r.add(i);o.l(e)<=0&&(s=s.add(n),r=o),i=w(i,1),n=w(n,1)}return t=g(e,s.j(t)),new _(s,t)}for(s=c;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=(i=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,i-48),o=(r=a(n)).j(t);p(o)||o.l(e)>0;)o=(r=a(n-=i)).j(t);d(r)&&(r=l),s=s.add(r),e=g(e,o)}return new _(s,e)}function v(e){const t=e.g.length+1,n=[];for(let i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new s(n,e.h)}function w(e,t){const n=t>>5;t%=32;const i=e.g.length-n,r=[];for(let s=0;s<i;s++)r[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new s(r,e.h)}(e=s.prototype).m=function(){if(p(this))return-f(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const i=this.i(n);e+=(i>=0?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(p(this))return"-"+f(this).toString(e);const t=a(Math.pow(e,6));var n=this;let i="";for(;;){const s=y(n,t).g;let r=(((n=g(n,s.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(d(n=s))return r+i;for(;r.length<6;)r="0"+r;i=r+i}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return p(e=g(this,e))?-1:d(e)?0:1},e.abs=function(){return p(this)?f(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let i=0;for(let s=0;s<=t;s++){let t=i+(65535&this.i(s))+(65535&e.i(s)),r=(t>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=r>>>16,t&=65535,r&=65535,n[s]=r<<16|t}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return c;if(p(this))return p(e)?f(this).j(f(e)):f(f(this).j(e));if(p(e))return f(this.j(f(e)));if(this.l(u)<0&&e.l(u)<0)return a(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){const s=this.i(i)>>>16,r=65535&this.i(i),o=e.i(t)>>>16,a=65535&e.i(t);n[2*i+2*t]+=r*a,m(n,2*i+2*t),n[2*i+2*t+1]+=s*a,m(n,2*i+2*t+1),n[2*i+2*t+1]+=r*o,m(n,2*i+2*t+1),n[2*i+2*t+2]+=s*o,m(n,2*i+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new s(n,0)},e.B=function(e){return y(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new s(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new s(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,h.Md5=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=a,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return f(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const i=a(Math.pow(n,8));let s=c;for(let e=0;e<t.length;e+=8){var r=Math.min(8,t.length-e);const o=parseInt(t.substring(e,e+r),n);r<8?(r=a(Math.pow(n,r)),s=s.j(r).add(a(o))):(s=s.j(i),s=s.add(a(o)))}return s},i=h.Integer=s}).apply(void 0!==c?c:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var l,u,d,p,f,g,m,_,y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},v={};(function(){var e,t=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof y&&y];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,i){if(i)e:{var s=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var o=e[r];if(!(o in s))break e;s=s[o]}(i=i(r=s[e=e[e.length-1]]))!=r&&null!=i&&t(s,e,{configurable:!0,writable:!0,value:i})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},r=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=a).apply(null,arguments)}function h(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function w(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}var I="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function E(e){const t=e.length;if(t>0){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function T(e,t){for(let t=1;t<arguments.length;t++){const i=arguments[t];var n=typeof i;if("array"==(n="object"!=n?n:i?Array.isArray(i)?"array":n:"null")||"object"==n&&"number"==typeof i.length){n=e.length||0;const t=i.length||0;e.length=n+t;for(let s=0;s<t;s++)e[n+s]=i[s]}else e.push(i)}}function b(e){r.setTimeout(()=>{throw e},0)}function C(){var e=R;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let A,N=!1,R=new class{constructor(){this.h=this.g=null}add(e,t){const n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},P=()=>{const e=Promise.resolve(void 0);A=()=>{e.then(O)}};function O(){for(var e;e=C();){try{e.h.call(e.g)}catch(e){b(e)}var t=S;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}N=!1}function D(){this.u=this.u,this.C=this.C}function x(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}D.prototype.u=!1,D.prototype.dispose=function(){this.u||(this.u=!0,this.N())},D.prototype[Symbol.dispose]=function(){this.dispose()},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},x.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch(e){}return e}();function M(e){return/^[\s\xa0]*$/.test(e)}function F(e,t){x.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}w(F,x),F.prototype.init=function(e,t){const n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&F.Z.h.call(this)},F.prototype.h=function(){F.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),V=0;function j(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=s,this.key=++V,this.da=this.fa=!1}function q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function H(e){const t={};for(const n in e)t[n]=e[n];return t}const W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<W.length;t++)n=W[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function z(e){this.src=e,this.g={},this.h=0}function K(e,t){const n=t.type;if(n in e.g){var i,s=e.g[n],r=Array.prototype.indexOf.call(s,t,void 0);(i=r>=0)&&Array.prototype.splice.call(s,r,1),i&&(q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function G(e,t,n,i){for(let s=0;s<e.length;++s){const r=e[s];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==i)return s}return-1}z.prototype.add=function(e,t,n,i,s){const r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);const o=G(e,t,i,s);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new j(t,this.src,r,!!i,s)).fa=n,e.push(t)),t};var Q="closure_lm_"+(1e6*Math.random()|0),Y={};function J(e,t,n,i,s){if(i&&i.once)return Z(e,t,n,i,s);if(Array.isArray(t)){for(let r=0;r<t.length;r++)J(e,t[r],n,i,s);return null}return n=oe(n),e&&e[U]?e.J(t,n,o(i)?!!i.capture:!!i,s):X(e,t,n,!1,i,s)}function X(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");const a=o(s)?!!s.capture:!!s;let c=se(e);if(c||(e[Q]=c=new z(e)),(n=c.add(t,n,i,a,r)).proxy)return n;if(i=function(){const e=ie;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)L||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(ne(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function Z(e,t,n,i,s){if(Array.isArray(t)){for(let r=0;r<t.length;r++)Z(e,t[r],n,i,s);return null}return n=oe(n),e&&e[U]?e.K(t,n,o(i)?!!i.capture:!!i,s):X(e,t,n,!0,i,s)}function ee(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)ee(e,t[r],n,i,s);else i=o(i)?!!i.capture:!!i,n=oe(n),e&&e[U]?(e=e.i,(r=String(t).toString())in e.g&&(n=G(t=e.g[r],n,i,s))>-1&&(q(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[r],e.h--))):e&&(e=se(e))&&(t=e.g[t.toString()],e=-1,t&&(e=G(t,n,i,s)),(n=e>-1?t[e]:null)&&te(n))}function te(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])K(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(ne(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=se(t))?(K(n,e),0==n.h&&(n.src=null,t[Q]=null)):q(e)}}}function ne(e){return e in Y?Y[e]:Y[e]="on"+e}function ie(e,t){if(e.da)e=!0;else{t=new F(t,this);const n=e.listener,i=e.ha||e.src;e.fa&&te(e),e=n.call(i,t)}return e}function se(e){return(e=e[Q])instanceof z?e:null}var re="__closure_events_fn_"+(1e9*Math.random()>>>0);function oe(e){return"function"==typeof e?e:(e[re]||(e[re]=function(t){return e.handleEvent(t)}),e[re])}function ae(){D.call(this),this.i=new z(this),this.M=this,this.G=null}function ce(e,t){var n,i=e.G;if(i)for(n=[];i;i=i.G)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new x(t,e);else if(t instanceof x)t.target=t.target||e;else{var s=t;$(t=new x(i,e),s)}let r,o;if(s=!0,n)for(o=n.length-1;o>=0;o--)r=t.g=n[o],s=he(r,i,!0,t)&&s;if(r=t.g=e,s=he(r,i,!0,t)&&s,s=he(r,i,!1,t)&&s,n)for(o=0;o<n.length;o++)r=t.g=n[o],s=he(r,i,!1,t)&&s}function he(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let r=0;r<t.length;++r){const o=t[r];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&K(e.i,o),s=!1!==t.call(n,i)&&s}}return s&&!i.defaultPrevented}function le(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return Number(t)>2147483647?-1:r.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,le(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}w(ae,D),ae.prototype[U]=!0,ae.prototype.removeEventListener=function(e,t,n,i){ee(this,e,t,n,i)},ae.prototype.N=function(){if(ae.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)q(n[e]);delete e.g[t],e.h--}}this.G=null},ae.prototype.J=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ae.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class ue extends D{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:le(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function de(e){D.call(this),this.h=e,this.g={}}w(de,D);var pe=[];function fe(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&te(e)},e),e.g={}}de.prototype.N=function(){de.Z.N.call(this),fe(this)},de.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ge=r.JSON.stringify,me=r.JSON.parse,_e=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function ye(){}function ve(){}var we={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ie(){x.call(this,"d")}function Ee(){x.call(this,"c")}w(Ie,x),w(Ee,x);var Te={},be=null;function Ce(){return be=be||new ae}function Se(e){x.call(this,Te.Ia,e)}function ke(e){const t=Ce();ce(t,new Se(t))}function Ae(e,t){x.call(this,Te.STAT_EVENT,e),this.stat=t}function Ne(e){const t=Ce();ce(t,new Ae(t,e))}function Re(e,t){x.call(this,Te.Ja,e),this.size=t}function Pe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){e()},t)}function Oe(){this.g=!0}function De(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<i.length;e++)i[e]=""}}}return ge(r)}catch(e){return t}}(e,n)+(i?" "+i:"")})}Te.Ia="serverreachability",w(Se,x),Te.STAT_EVENT="statevent",w(Ae,x),Te.Ja="timingevent",w(Re,x),Oe.prototype.ua=function(){this.g=!1},Oe.prototype.info=function(){};var xe,Le={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Me={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Fe(){}function Ue(e){return encodeURIComponent(String(e))}function Ve(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function je(e,t,n,i){this.j=e,this.i=t,this.l=n,this.S=i||1,this.V=new de(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new qe}function qe(){this.i=null,this.g="",this.h=!1}w(Fe,ye),Fe.prototype.g=function(){return new XMLHttpRequest},xe=new Fe;var Be={},He={};function We(e,t,n){e.M=1,e.A=gt(lt(t)),e.u=n,e.R=!0,$e(e,null)}function $e(e,t){e.F=Date.now(),Ge(e),e.B=lt(e.A);var n=e.B,i=e.S;Array.isArray(i)||(i=[String(i)]),Nt(n.i,"t",i),e.C=0,n=e.j.L,e.h=new qe,e.g=mn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new ue(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,i=e.ba;var s="readystatechange";Array.isArray(s)||(s&&(pe[0]=s.toString()),s=pe);for(let e=0;e<s.length;e++){const r=J(n,s[e],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?H(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ke(),function(e,t,n,i,s,r){e.info(function(){if(e.g)if(r){var o="",a=r.split("&");for(let e=0;e<a.length;e++){var c=a[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+c+"&":o+(e+"=redacted&")}}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function ze(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Ke(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?He:(n=Number(t.substring(n,i)),isNaN(n)?Be:(i+=1)+n>t.length?He:(t=t.slice(i,i+n),e.C=i+n,t))}function Ge(e){e.T=Date.now()+e.H,Qe(e,e.H)}function Qe(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=Pe(c(e.aa,e),t)}function Ye(e){e.D&&(r.clearTimeout(e.D),e.D=null)}function Je(e){0==e.j.I||e.K||un(e.j,e)}function Xe(e){Ye(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,fe(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Ze(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||st(n.h,e)))if(!e.L&&st(n.h,e)&&3==n.I){try{var i=n.Ba.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;ln(n),Zt(n)}an(n),Ne(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=Pe(c(n.Va,n),6e3));it(n.h)<=1&&n.ta&&(n.ta=void 0)}else pn(n,11)}else if((e.L||n.g==e)&&ln(n),!M(t))for(s=n.Ba.g.parse(t),t=0;t<s.length;t++){let c=s[t];const l=c[0];if(!(l<=n.K))if(n.K=l,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const s=c[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const l=c[5];null!=l&&"number"==typeof l&&l>0&&(i=1.5*l,n.O=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(rt(r,r.h),r.h=null))}if(i.G){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.wa=e,ft(i.J,i.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((i=n).na=gn(i,i.L?i.ba:null,i.W),o.L){ot(i.h,o);var a=o,h=i.O;h&&(a.H=h),a.D&&(Ye(a),Ge(a)),i.g=o}else on(i);n.i.length>0&&tn(n)}else"stop"!=c[0]&&"close"!=c[0]||pn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?pn(n,7):Xt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}ke()}catch(e){}}je.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Gt(e)?t.j():this.Y(e)},je.prototype.Y=function(e){try{if(e==this.g)e:{const c=Gt(this.g),h=this.g.ya();if(this.g.ca(),!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Qt(this.g)))){this.K||4!=c||7==h||ke(),Ye(this);var t=this.g.ca();this.X=t;var n=function(e){if(!ze(e))return e.g.la();const t=Qt(e.g);if(""===t)return"";let n="";const i=t.length,s=4==Gt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return Xe(e),Je(e),"";e.h.i=new r.TextDecoder}for(let r=0;r<i;r++)e.h.h=!0,n+=e.h.i.decode(t[r],{stream:!(s&&r==i-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,i,s,r,o){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var i,s=this.g;if((i=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(i)){var o=i;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,Ne(12),Xe(this),Je(this);break e}De(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ze(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Ke(this,n),t==He){4==c&&(this.m=4,Ne(14),e=!1),De(this.i,this.l,null,"[Incomplete Response]");break}if(t==Be){this.m=4,Ne(15),De(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}De(this.i,this.l,t,null),Ze(this,t)}if(ze(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,Ne(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),cn(a),a.P=!0,Ne(11))}}else De(this.i,this.l,n,"[Invalid Chunked Response]"),Xe(this),Je(this)}else De(this.i,this.l,n,null),Ze(this,n);4==c&&Xe(this),this.o&&!this.K&&(4==c?un(this.j,this):(this.o=!1,Ge(this)))}else(function(e){const t={};e=(e.g&&Gt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(M(e[i]))continue;var n=Ve(e[i]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=t[s]||[];t[s]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,Ne(12)):(this.m=0,Ne(13)),Xe(this),Je(this)}}}catch(e){}},je.prototype.cancel=function(){this.K=!0,Xe(this)},je.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ke(),Ne(17)),Xe(this),this.m=2,Je(this)):Qe(this,this.T-e)};var et=class{constructor(e,t){this.g=e,this.map=t}};function tt(e){this.l=e||10,e=r.PerformanceNavigationTiming?(e=r.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function nt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function it(e){return e.h?1:e.g?e.g.size:0}function st(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function rt(e,t){e.g?e.g.add(t):e.h=t}function ot(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function at(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return E(e.i)}tt.prototype.cancel=function(){if(this.i=at(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ct=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ht(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof ht?(this.l=e.l,ut(this,e.j),this.o=e.o,this.g=e.g,dt(this,e.u),this.h=e.h,pt(this,Rt(e.i)),this.m=e.m):e&&(t=String(e).match(ct))?(this.l=!1,ut(this,t[1]||"",!0),this.o=mt(t[2]||""),this.g=mt(t[3]||"",!0),dt(this,t[4]),this.h=mt(t[5]||"",!0),pt(this,t[6]||"",!0),this.m=mt(t[7]||"")):(this.l=!1,this.i=new bt(null,this.l))}function lt(e){return new ht(e)}function ut(e,t,n){e.j=n?mt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function dt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function pt(e,t,n){t instanceof bt?(e.i=t,function(e,t){t&&!e.j&&(Ct(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(St(this,t),Nt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=_t(t,Et)),e.i=new bt(t,e.l))}function ft(e,t,n){e.i.set(t,n)}function gt(e){return ft(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function mt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function _t(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,yt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function yt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ht.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(_t(t,vt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(_t(t,vt,!0),"@"),e.push(Ue(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(_t(n,"/"==n.charAt(0)?It:wt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",_t(n,Tt)),e.join("")},ht.prototype.resolve=function(e){const t=lt(this);let n=!!e.j;n?ut(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var i=e.h;if(n)dt(t,e.u);else if(n=!!e.h){if("/"!=i.charAt(0))if(this.g&&!this.h)i="/"+i;else{var s=t.h.lastIndexOf("/");-1!=s&&(i=t.h.slice(0,s+1)+i)}if(".."==(s=i)||"."==s)i="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){i=0==s.lastIndexOf("/",0),s=s.split("/");const e=[];for(let t=0;t<s.length;){const n=s[t++];"."==n?i&&t==s.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),i&&t==s.length&&e.push("")):(e.push(n),i=!0)}i=e.join("/")}else i=s}return n?t.h=i:n=""!==e.i.toString(),n?pt(t,Rt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var vt=/[#\/\?@]/g,wt=/[#\?:]/g,It=/[#\?]/g,Et=/[#\?@]/g,Tt=/#/g;function bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ct(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const i=e[n].indexOf("=");let s,r=null;i>=0?(s=e[n].substring(0,i),r=e[n].substring(i+1)):s=e[n],t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function St(e,t){Ct(e),t=Pt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function kt(e,t){return Ct(e),t=Pt(e,t),e.g.has(t)}function At(e,t){Ct(e);let n=[];if("string"==typeof t)kt(e,t)&&(n=n.concat(e.g.get(Pt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function Nt(e,t,n){St(e,t),n.length>0&&(e.i=null,e.g.set(Pt(e,t),E(n)),e.h+=n.length)}function Rt(e){const t=new bt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function Pt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ot(e,t,n,i,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),i(n)}catch(e){}}function Dt(){this.g=new _e}function xt(e){this.i=e.Sb||null,this.h=e.ab||!1}function Lt(e,t){ae.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Mt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function Ft(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Ut(e)}function Ut(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Vt(e){let t="";return B(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function jt(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Vt(n),"string"==typeof e?null!=n&&Ue(n):ft(e,t,n))}function qt(e){ae.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=bt.prototype).add=function(e,t){Ct(this),this.i=null,e=Pt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Ct(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},e.set=function(e,t){return Ct(this),this.i=null,kt(this,e=Pt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=At(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let i=0;i<t.length;i++){var n=t[i];const s=Ue(n);n=At(this,n);for(let t=0;t<n.length;t++){let i=s;""!==n[t]&&(i+="="+Ue(n[t])),e.push(i)}}return this.i=e.join("&")},w(xt,ye),xt.prototype.g=function(){return new Lt(this.i,this.h)},w(Lt,ae),(e=Lt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Ut(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||r).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ft(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ut(this)),this.g&&(this.readyState=3,Ut(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Mt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ft(this):Ut(this),3==this.readyState&&Mt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,Ft(this))},e.Na=function(e){this.g&&(this.response=e,Ft(this))},e.ga=function(){this.g&&Ft(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Lt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),w(qt,ae);var Bt=/^https?$/i,Ht=["POST","PUT"];function Wt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,$t(e),Kt(e)}function $t(e){e.A||(e.A=!0,ce(e,"complete"),ce(e,"error"))}function zt(e){if(e.h&&void 0!==s)if(e.v&&4==Gt(e))setTimeout(e.Ca.bind(e),0);else if(ce(e,"readystatechange"),4==Gt(e)){e.h=!1;try{const s=e.ca();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===s){let t=String(e.D).match(ct)[1]||null;!t&&r.self&&r.self.location&&(t=r.self.location.protocol.slice(0,-1)),i=!Bt.test(t?t.toLowerCase():"")}n=i}if(n)ce(e,"complete"),ce(e,"success");else{e.o=6;try{var o=Gt(e)>2?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.ca()+"]",$t(e)}}finally{Kt(e)}}}function Kt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const n=e.g;e.g=null,t||ce(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function Gt(e){return e.g?e.g.readyState:0}function Qt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Yt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Jt(e){this.za=0,this.i=[],this.j=new Oe,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Yt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Yt("baseRetryDelayMs",5e3,e),this.Za=Yt("retryDelaySeedMs",1e4,e),this.Ta=Yt("forwardChannelMaxRetries",2,e),this.va=Yt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new tt(e&&e.concurrentRequestLimit),this.Ba=new Dt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Xt(e){if(en(e),3==e.I){var t=e.V++,n=lt(e.J);if(ft(n,"SID",e.M),ft(n,"RID",t),ft(n,"TYPE","terminate"),sn(e,n),(t=new je(e,e.j,t)).M=2,t.A=gt(lt(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&r.Image&&((new Image).src=t.A,n=!0),n||(t.g=mn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Ge(t)}fn(e)}function Zt(e){e.g&&(cn(e),e.g.cancel(),e.g=null)}function en(e){Zt(e),e.v&&(r.clearTimeout(e.v),e.v=null),ln(e),e.h.cancel(),e.m&&("number"==typeof e.m&&r.clearTimeout(e.m),e.m=null)}function tn(e){if(!nt(e.h)&&!e.m){e.m=!0;var t=e.Ea;A||P(),N||(A(),N=!0),R.add(t,e),e.D=0}}function nn(e,t){var n;n=t?t.l:e.V++;const i=lt(e.J);ft(i,"SID",e.M),ft(i,"RID",n),ft(i,"AID",e.K),sn(e,i),e.u&&e.o&&jt(i,e.u,e.o),n=new je(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=rn(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),rt(e.h,n),We(n,i,t)}function sn(e,t){e.H&&B(e.H,function(e,n){ft(t,n,e)}),e.l&&B({},function(e,n){ft(t,n,e)})}function rn(e,t,n){n=Math.min(e.i.length,n);const i=e.l?c(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let h=0;h<n;h++){var r=s[h].g;const n=s[h].map;if((r-=t)<0)t=Math.max(0,s[h].g-100),c=!1;else try{r="req"+r+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let i=n;o(n)&&(i=ge(n)),e.push(r+t+"="+encodeURIComponent(i))}}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}catch(e){i&&i(n)}}if(c){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function on(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;A||P(),N||(A(),N=!0),R.add(t,e),e.A=0}}function an(e){return!(e.g||e.v||e.A>=3||(e.Y++,e.v=Pe(c(e.Da,e),dn(e,e.A)),e.A++,0))}function cn(e){null!=e.B&&(r.clearTimeout(e.B),e.B=null)}function hn(e){e.g=new je(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=lt(e.na);ft(t,"RID","rpc"),ft(t,"SID",e.M),ft(t,"AID",e.K),ft(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&ft(t,"TO",e.ia),ft(t,"TYPE","xmlhttp"),sn(e,t),e.u&&e.o&&jt(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=gt(lt(t)),n.u=null,n.R=!0,$e(n,e)}function ln(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function un(e,t){var n=null;if(e.g==t){ln(e),cn(e),e.g=null;var i=2}else{if(!st(e.h,t))return;n=t.G,ot(e.h,t),i=1}if(0!=e.I)if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ce(i=Ce(),new Re(i,n)),tn(e)}else on(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&function(e,t){return!(it(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=Pe(c(e.Ea,e,t),dn(e,e.D)),e.D++,0)))}(e,t)||2==i&&an(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),s){case 1:pn(e,5);break;case 4:pn(e,10);break;case 3:pn(e,6);break;default:pn(e,2)}}function dn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function pn(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),i=e.Ua;const t=!i;i=new ht(i||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||ut(i,"https"),gt(i),t?function(e,t){const n=new Oe;if(r.Image){const i=new Image;i.onload=h(Ot,n,"TestLoadImage: loaded",!0,t,i),i.onerror=h(Ot,n,"TestLoadImage: error",!1,t,i),i.onabort=h(Ot,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=h(Ot,n,"TestLoadImage: timeout",!1,t,i),r.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new Oe;const n=new AbortController,i=setTimeout(()=>{n.abort(),Ot(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?Ot(0,0,!0,t):Ot(0,0,!1,t)}).catch(()=>{clearTimeout(i),Ot(0,0,!1,t)})}(i.toString(),n)}else Ne(2);e.I=0,e.l&&e.l.pa(t),fn(e),en(e)}function fn(e){if(e.I=0,e.ja=[],e.l){const t=at(e.h);0==t.length&&0==e.i.length||(T(e.ja,t),T(e.ja,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.oa()}}function gn(e,t,n){var i=n instanceof ht?lt(n):new ht(n);if(""!=i.g)t&&(i.g=t+"."+i.g),dt(i,i.u);else{var s=r.location;i=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;const e=new ht(null);i&&ut(e,i),t&&(e.g=t),s&&dt(e,s),n&&(e.h=n),i=e}return n=e.G,t=e.wa,n&&t&&ft(i,n,t),ft(i,"VER",e.ka),sn(e,i),i}function mn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new qt(new xt({ab:n})):new qt(e.ma)).Fa(e.L),t}function _n(){}function yn(){}function vn(e,t){ae.call(this),this.g=new Jt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!M(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!M(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new En(this)}function wn(e){Ie.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function In(){Ee.call(this),this.status=1}function En(e){this.g=e}(e=qt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():xe.g(),this.g.onreadystatechange=I(c(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Wt(this,e)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=r.FormData&&e instanceof r.FormData,!(Array.prototype.indexOf.call(Ht,t,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(e){Wt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ce(this,"complete"),ce(this,"abort"),Kt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Kt(this,!0)),qt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?zt(this):this.Xa())},e.Xa=function(){zt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Gt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),me(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Jt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,i){Ne(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.J=gn(this,null,this.W),tn(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new je(this,this.j,e);let r=this.o;if(this.U&&(r?(r=H(r),$(r,this.U)):r=this.U),null!==this.u||this.R||(s.J=r,r=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if((t+=i)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=rn(this,s,t),ft(n=lt(this.J),"RID",e),ft(n,"CVER",22),this.G&&ft(n,"X-HTTP-Session-Id",this.G),sn(this,n),r&&(this.R?t="headers="+Ue(Vt(r))+"&"+t:this.u&&jt(n,this.u,r)),rt(this.h,s),this.Ra&&ft(n,"TYPE","init"),this.S?(ft(n,"$req",t),ft(n,"SID","null"),s.U=!0,We(s,n,null)):We(s,n,t),this.I=2}}else 3==this.I&&(e?nn(this,e):0==this.i.length||nt(this.h)||nn(this))},e.Da=function(){if(this.v=null,hn(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=Pe(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ne(10),Zt(this),hn(this))},e.Va=function(){null!=this.C&&(this.C=null,Zt(this),an(this),Ne(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=_n.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},yn.prototype.g=function(e,t){return new vn(e,t)},w(vn,ae),vn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},vn.prototype.close=function(){Xt(this.g)},vn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ge(e),e=n);t.i.push(new et(t.Ya++,e)),3==t.I&&tn(t)},vn.prototype.N=function(){this.g.l=null,delete this.j,Xt(this.g),delete this.g,vn.Z.N.call(this)},w(wn,Ie),w(In,Ee),w(En,_n),En.prototype.ra=function(){ce(this.g,"a")},En.prototype.qa=function(e){ce(this.g,new wn(e))},En.prototype.pa=function(e){ce(this.g,new In)},En.prototype.oa=function(){ce(this.g,"b")},yn.prototype.createWebChannel=yn.prototype.g,vn.prototype.send=vn.prototype.o,vn.prototype.open=vn.prototype.m,vn.prototype.close=vn.prototype.close,_=v.createWebChannelTransport=function(){return new yn},m=v.getStatEventTarget=function(){return Ce()},g=v.Event=Te,f=v.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Le.NO_ERROR=0,Le.TIMEOUT=8,Le.HTTP_ERROR=6,p=v.ErrorCode=Le,Me.COMPLETE="complete",d=v.EventType=Me,ve.EventType=we,we.OPEN="a",we.CLOSE="b",we.ERROR="c",we.MESSAGE="d",ae.prototype.listen=ae.prototype.J,u=v.WebChannel=ve,v.FetchXmlHttpFactory=xt,qt.prototype.listenOnce=qt.prototype.K,qt.prototype.getLastError=qt.prototype.Ha,qt.prototype.getLastErrorCode=qt.prototype.ya,qt.prototype.getStatus=qt.prototype.ca,qt.prototype.getResponseJson=qt.prototype.La,qt.prototype.getResponseText=qt.prototype.la,qt.prototype.send=qt.prototype.ea,qt.prototype.setWithCredentials=qt.prototype.Fa,l=v.XhrIo=qt}).apply(void 0!==y?y:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const w="@firebase/firestore",I="4.9.2";class E{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}E.UNAUTHENTICATED=new E(null),E.GOOGLE_CREDENTIALS=new E("google-credentials-uid"),E.FIRST_PARTY=new E("first-party-uid"),E.MOCK_USER=new E("mock-user");let T="12.3.0";const b=new o.Vy("@firebase/firestore");function C(){return b.logLevel}function S(e,...t){if(b.logLevel<=o.$b.DEBUG){const n=t.map(N);b.debug(`Firestore (${T}): ${e}`,...n)}}function k(e,...t){if(b.logLevel<=o.$b.ERROR){const n=t.map(N);b.error(`Firestore (${T}): ${e}`,...n)}}function A(e,...t){if(b.logLevel<=o.$b.WARN){const n=t.map(N);b.warn(`Firestore (${T}): ${e}`,...n)}}function N(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function R(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,P(e,i,n)}function P(e,t,n){let i=`FIRESTORE (${T}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw k(i),new Error(i)}function O(e,t,n,i){let s="Unexpected state";"string"==typeof n?s=n:i=n,e||P(t,s,i)}function D(e,t){return e}const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends a.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class M{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class F{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class U{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(E.UNAUTHENTICATED))}shutdown(){}}class V{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class j{constructor(e){this.t=e,this.currentUser=E.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){O(void 0===this.o,42304);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new M;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new M,e.enqueueRetryable(()=>i(this.currentUser))};const r=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},o=e=>{S("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(S("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new M)}},0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(S("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(O("string"==typeof t.accessToken,31837,{l:t}),new F(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return O(null===e||"string"==typeof e,2055,{h:e}),new E(e)}}class q{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=E.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class B{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new q(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(E.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class H{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class W{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,s.xZ)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){O(void 0===this.o,3512);const n=e=>{null!=e.error&&S("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,S("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const i=e=>{S("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?i(e):S("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new H(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(O("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new H(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function $(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class z{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=$(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function K(e,t){return e<t?-1:e>t?1:0}function G(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.charAt(i),s=t.charAt(i);if(n!==s)return J(n)===J(s)?K(n,s):J(n)?1:-1}return K(e.length,t.length)}const Q=55296,Y=57343;function J(e){const t=e.charCodeAt(0);return t>=Q&&t<=Y}function X(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}const Z="__name__";class ee{constructor(e,t,n){void 0===t?t=0:t>e.length&&R(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&R(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ee.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ee?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=ee.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return K(e.length,t.length)}static compareSegments(e,t){const n=ee.isNumericId(e),i=ee.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?ee.extractNumericId(e).compare(ee.extractNumericId(t)):G(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return i.fromString(e.substring(4,e.length-2))}}class te extends ee{construct(e,t,n){return new te(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new L(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new te(t)}static emptyPath(){return new te([])}}const ne=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ie extends ee{construct(e,t,n){return new ie(e,t,n)}static isValidIdentifier(e){return ne.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ie.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Z}static keyField(){return new ie([Z])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new L(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new L(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new L(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new L(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ie(t)}static emptyPath(){return new ie([])}}class se{constructor(e){this.path=e}static fromPath(e){return new se(te.fromString(e))}static fromName(e){return new se(te.fromString(e).popFirst(5))}static empty(){return new se(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===te.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new te(e.slice()))}}function re(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new L(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":R(12329,{type:typeof e})}(e);throw new L(x.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function oe(e,t){const n={typeString:e};return t&&(n.value=t),n}function ae(e,t){if(!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(e))throw new L(x.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in t)if(t[i]){const s=t[i].typeString,r="value"in t[i]?{value:t[i].value}:void 0;if(!(i in e)){n=`JSON missing required field: '${i}'`;break}const o=e[i];if(s&&typeof o!==s){n=`JSON field '${i}' must be a ${s}.`;break}if(void 0!==r&&o!==r.value){n=`Expected '${i}' field to equal '${r.value}'`;break}}if(n)throw new L(x.INVALID_ARGUMENT,n);return!0}const ce=-62135596800,he=1e6;class le{static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*he);return new le(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ce)throw new L(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/he}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:le._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ae(e,le._jsonSchema))return new le(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ce;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}le._jsonSchemaVersion="firestore/timestamp/1.0",le._jsonSchema={type:oe("string",le._jsonSchemaVersion),seconds:oe("number"),nanoseconds:oe("number")};class ue{static fromTimestamp(e){return new ue(e)}static min(){return new ue(new le(0,0))}static max(){return new ue(new le(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function de(e){return new pe(e.readTime,e.key,-1)}class pe{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new pe(ue.min(),se.empty(),-1)}static max(){return new pe(ue.max(),se.empty(),-1)}}function fe(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=se.comparator(e.documentKey,t.documentKey),0!==n?n:K(e.largestBatchId,t.largestBatchId))}class ge{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class me{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&R(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new me((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof me?t:me.resolve(t)}catch(e){return me.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):me.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):me.reject(t)}static resolve(e){return new me((t,n)=>{t(e)})}static reject(e){return new me((t,n)=>{n(e)})}static waitFor(e){return new me((t,n)=>{let i=0,s=0,r=!1;e.forEach(e=>{++i,e.next(()=>{++s,r&&s===i&&t()},e=>n(e))}),r=!0,s===i&&t()})}static or(e){let t=me.resolve(!1);for(const n of e)t=t.next(e=>e?me.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new me((n,i)=>{const s=e.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next(e=>{r[c]=e,++o,o===s&&n(r)},e=>i(e))}})}static doWhile(e,t){return new me((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}function _e(e){return"IndexedDbTransactionError"===e.name}class ye{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ye.ce=-1;function ve(e){return null==e}function we(e){return 0===e&&1/e==-1/0}const Ie="owner",Ee="mutationQueues",Te="mutations",be="documentMutations",Ce="remoteDocumentGlobal",Se="targets",ke="targetDocuments",Ae="targetGlobal",Ne="collectionParents",Re="clientMetadata",Pe="bundles",Oe="namedQueries";function De(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function xe(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}class Le{constructor(e,t){this.comparator=e,this.root=t||Fe.EMPTY}insert(e,t){return new Le(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Fe.BLACK,null,null))}remove(e){return new Le(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Fe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Me(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Me(this.root,e,this.comparator,!1)}getReverseIterator(){return new Me(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Me(this.root,e,this.comparator,!0)}}class Me{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Fe{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Fe.RED,this.left=null!=i?i:Fe.EMPTY,this.right=null!=s?s:Fe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Fe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Fe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Fe.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Fe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Fe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw R(43730,{key:this.key,value:this.value});if(this.right.isRed())throw R(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw R(27949);return e+(this.isRed()?0:1)}}Fe.EMPTY=null,Fe.RED=!0,Fe.BLACK=!1,Fe.EMPTY=new class{constructor(){this.size=0}get key(){throw R(57766)}get value(){throw R(16141)}get color(){throw R(16727)}get left(){throw R(29726)}get right(){throw R(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new Fe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ue{constructor(e){this.comparator=e,this.data=new Le(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ve(this.data.getIterator())}getIteratorFrom(e){return new Ve(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ue))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ue(this.comparator);return t.data=e,t}}class Ve{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class je{constructor(e){this.fields=e,e.sort(ie.comparator)}static empty(){return new je([])}unionWith(e){let t=new Ue(ie.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new je(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return X(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class qe extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Be{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new qe("Invalid base64 string: "+e):e}}(e);return new Be(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Be(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Be.EMPTY_BYTE_STRING=new Be("");const He=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function We(e){if(O(!!e,39018),"string"==typeof e){let t=0;const n=He.exec(e);if(O(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:$e(e.seconds),nanos:$e(e.nanos)}}function $e(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ze(e){return"string"==typeof e?Be.fromBase64String(e):Be.fromUint8Array(e)}const Ke="server_timestamp",Ge="__type__",Qe="__previous_value__",Ye="__local_write_time__";function Je(e){const t=(e?.mapValue?.fields||{})[Ge]?.stringValue;return t===Ke}function Xe(e){const t=e.mapValue.fields[Qe];return Je(t)?Xe(t):t}function Ze(e){const t=We(e.mapValue.fields[Ye].timestampValue);return new le(t.seconds,t.nanos)}const et="(default)";class tt{constructor(e,t){this.projectId=e,this.database=t||et}static empty(){return new tt("","")}get isDefaultDatabase(){return this.database===et}isEqual(e){return e instanceof tt&&e.projectId===this.projectId&&e.database===this.database}}const nt="__max__",it={fields:{__type__:{stringValue:nt}}},st="value";function rt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Je(e)?4:yt(e)?9007199254740991:mt(e)?10:11:R(28295,{value:e})}function ot(e,t){if(e===t)return!0;const n=rt(e);if(n!==rt(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ze(e).isEqual(Ze(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=We(e.timestampValue),i=We(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ze(e.bytesValue).isEqual(ze(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return $e(e.geoPointValue.latitude)===$e(t.geoPointValue.latitude)&&$e(e.geoPointValue.longitude)===$e(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return $e(e.integerValue)===$e(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=$e(e.doubleValue),i=$e(t.doubleValue);return n===i?we(n)===we(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return X(e.arrayValue.values||[],t.arrayValue.values||[],ot);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(De(n)!==De(i))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!ot(n[e],i[e])))return!1;return!0}(e,t);default:return R(52216,{left:e})}}function at(e,t){return void 0!==(e.values||[]).find(e=>ot(e,t))}function ct(e,t){if(e===t)return 0;const n=rt(e),i=rt(t);if(n!==i)return K(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return K(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=$e(e.integerValue||e.doubleValue),i=$e(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return ht(e.timestampValue,t.timestampValue);case 4:return ht(Ze(e),Ze(t));case 5:return G(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ze(e),i=ze(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){const t=K(n[e],i[e]);if(0!==t)return t}return K(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=K($e(e.latitude),$e(t.latitude));return 0!==n?n:K($e(e.longitude),$e(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return lt(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},i=t.fields||{},s=n[st]?.arrayValue,r=i[st]?.arrayValue,o=K(s?.values?.length||0,r?.values?.length||0);return 0!==o?o:lt(s,r)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===it&&t===it)return 0;if(e===it)return 1;if(t===it)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let e=0;e<i.length&&e<r.length;++e){const t=G(i[e],r[e]);if(0!==t)return t;const o=ct(n[i[e]],s[r[e]]);if(0!==o)return o}return K(i.length,r.length)}(e.mapValue,t.mapValue);default:throw R(23264,{he:n})}}function ht(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return K(e,t);const n=We(e),i=We(t),s=K(n.seconds,i.seconds);return 0!==s?s:K(n.nanos,i.nanos)}function lt(e,t){const n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){const t=ct(n[e],i[e]);if(t)return t}return K(n.length,i.length)}function ut(e){return dt(e)}function dt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=We(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return ze(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return se.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=dt(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+=`${s}:${dt(e.fields[s])}`;return n+"}"}(e.mapValue):R(61005,{value:e})}function pt(e){return!!e&&"integerValue"in e}function ft(e){return!!e&&"arrayValue"in e}function gt(e){return!!e&&"mapValue"in e}function mt(e){const t=(e?.mapValue?.fields||{}).__type__?.stringValue;return"__vector__"===t}function _t(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return xe(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=_t(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=_t(e.arrayValue.values[n]);return t}return{...e}}function yt(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nt}class vt{constructor(e){this.value=e}static empty(){return new vt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!gt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_t(t)}setAll(e){let t=ie.emptyPath(),n={},i=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=_t(e):i.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());gt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ot(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];gt(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){xe(t,(t,n)=>e[t]=n);for(const t of n)delete e[t]}clone(){return new vt(_t(this.value))}}class wt{constructor(e,t,n,i,s,r,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(e){return new wt(e,0,ue.min(),ue.min(),ue.min(),vt.empty(),0)}static newFoundDocument(e,t,n,i){return new wt(e,1,t,ue.min(),n,i,0)}static newNoDocument(e,t){return new wt(e,2,t,ue.min(),ue.min(),vt.empty(),0)}static newUnknownDocument(e,t){return new wt(e,3,t,ue.min(),ue.min(),vt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ue.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof wt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class It{constructor(e,t){this.position=e,this.inclusive=t}}function Et(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],o=e.position[s];if(i=r.field.isKeyField()?se.comparator(se.fromName(o.referenceValue),n.key):ct(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function Tt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ot(e.position[n],t.position[n]))return!1;return!0}class bt{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ct(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class St{}class kt extends St{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new xt(e,t,n):"array-contains"===t?new Ut(e,n):"in"===t?new Vt(e,n):"not-in"===t?new jt(e,n):"array-contains-any"===t?new qt(e,n):new kt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Lt(e,n):new Mt(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(ct(t,this.value)):null!==t&&rt(this.value)===rt(t)&&this.matchesComparison(ct(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return R(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class At extends St{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new At(e,t)}matches(e){return Nt(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Nt(e){return"and"===e.op}function Rt(e){return function(e){for(const t of e.filters)if(t instanceof At)return!1;return!0}(e)&&Nt(e)}function Pt(e){if(e instanceof kt)return e.field.canonicalString()+e.op.toString()+ut(e.value);if(Rt(e))return e.filters.map(e=>Pt(e)).join(",");{const t=e.filters.map(e=>Pt(e)).join(",");return`${e.op}(${t})`}}function Ot(e,t){return e instanceof kt?function(e,t){return t instanceof kt&&e.op===t.op&&e.field.isEqual(t.field)&&ot(e.value,t.value)}(e,t):e instanceof At?function(e,t){return t instanceof At&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,i)=>e&&Ot(n,t.filters[i]),!0)}(e,t):void R(19439)}function Dt(e){return e instanceof kt?function(e){return`${e.field.canonicalString()} ${e.op} ${ut(e.value)}`}(e):e instanceof At?function(e){return e.op.toString()+" {"+e.getFilters().map(Dt).join(" ,")+"}"}(e):"Filter"}class xt extends kt{constructor(e,t,n){super(e,t,n),this.key=se.fromName(n.referenceValue)}matches(e){const t=se.comparator(e.key,this.key);return this.matchesComparison(t)}}class Lt extends kt{constructor(e,t){super(e,"in",t),this.keys=Ft(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Mt extends kt{constructor(e,t){super(e,"not-in",t),this.keys=Ft(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ft(e,t){return(t.arrayValue?.values||[]).map(e=>se.fromName(e.referenceValue))}class Ut extends kt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ft(t)&&at(t.arrayValue,this.value)}}class Vt extends kt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&at(this.value.arrayValue,t)}}class jt extends kt{constructor(e,t){super(e,"not-in",t)}matches(e){if(at(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!at(this.value.arrayValue,t)}}class qt extends kt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ft(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>at(this.value.arrayValue,e))}}class Bt{constructor(e,t=null,n=[],i=[],s=null,r=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.Te=null}}function Ht(e,t=null,n=[],i=[],s=null,r=null,o=null){return new Bt(e,t,n,i,s,r,o)}function Wt(e){const t=D(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Pt(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),ve(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>ut(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>ut(e)).join(",")),t.Te=e}return t.Te}function $t(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ct(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Ot(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Tt(e.startAt,t.startAt)&&Tt(e.endAt,t.endAt)}class zt{constructor(e,t=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Kt(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Gt(e){const t=D(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ie.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",i=function(e){let t=new Ue(ie.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);i.forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new bt(i,n))}),e.has(ie.keyField().canonicalString())||t.Ie.push(new bt(ie.keyField(),n))}return t.Ie}function Qt(e){const t=D(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return Ht(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new bt(e.field,t)});const n=e.endAt?new It(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new It(e.startAt.position,e.startAt.inclusive):null;return Ht(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(t,Gt(e))),t.Ee}function Yt(e,t,n){return new zt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Jt(e,t){return $t(Qt(e),Qt(t))&&e.limitType===t.limitType}function Xt(e){return`${Wt(Qt(e))}|lt:${e.limitType}`}function Zt(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Dt(e)).join(", ")}]`),ve(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>ut(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>ut(e)).join(",")),`Target(${t})`}(Qt(e))}; limitType=${e.limitType})`}function en(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):se.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Gt(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Et(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,Gt(e),t)||e.endAt&&!function(e,t,n){const i=Et(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,Gt(e),t))}(e,t)}function tn(e,t,n){const i=e.field.isKeyField()?se.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?ct(i,s):R(42886)}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return R(19790,{direction:e.dir})}}class nn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,i]of n)if(this.equalsFn(t,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){xe(this.inner,(t,n)=>{for(const[t,i]of n)e(t,i)})}isEmpty(){return function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(this.inner)}size(){return this.innerSize}}const sn=new Le(se.comparator);function rn(){return sn}const on=new Le(se.comparator);function an(...e){let t=on;for(const n of e)t=t.insert(n.key,n);return t}function cn(e){let t=on;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function hn(){return un()}function ln(){return un()}function un(){return new nn(e=>e.toString(),(e,t)=>e.isEqual(t))}new Le(se.comparator);const dn=new Ue(se.comparator);function pn(...e){let t=dn;for(const n of e)t=t.add(n);return t}const fn=new Ue(K);class gn{constructor(){this._=void 0}}function mn(e,t,n){return e instanceof yn?function(e,t){const n={fields:{[Ge]:{stringValue:Ke},[Ye]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Je(t)&&(t=Xe(t)),t&&(n.fields[Qe]=t),{mapValue:n}}(n,t):e instanceof vn?wn(e,t):e instanceof In?En(e,t):function(e,t){const n=function(e,t){return e instanceof Tn?function(e){return pt(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}(e,t),i=bn(n)+bn(e.Ae);return pt(n)&&pt(e.Ae)?function(e){return{integerValue:""+e}}(i):function(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:we(t)?"-0":t}}(e.serializer,i)}(e,t)}function _n(e,t,n){return e instanceof vn?wn(e,t):e instanceof In?En(e,t):n}class yn extends gn{}class vn extends gn{constructor(e){super(),this.elements=e}}function wn(e,t){const n=Cn(t);for(const t of e.elements)n.some(e=>ot(e,t))||n.push(t);return{arrayValue:{values:n}}}class In extends gn{constructor(e){super(),this.elements=e}}function En(e,t){let n=Cn(t);for(const t of e.elements)n=n.filter(e=>!ot(e,t));return{arrayValue:{values:n}}}class Tn extends gn{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function bn(e){return $e(e.integerValue||e.doubleValue)}function Cn(e){return ft(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Sn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Sn}static exists(e){return new Sn(void 0,e)}static updateTime(e){return new Sn(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function kn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class An{}function Nn(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Un(e.key,Sn.none()):new Dn(e.key,e.data,Sn.none());{const n=e.data,i=vt.empty();let s=new Ue(ie.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),s=s.add(e)}return new xn(e.key,i,new je(s.toArray()),Sn.none())}}function Rn(e,t,n){e instanceof Dn?function(e,t,n){const i=e.value.clone(),s=Mn(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof xn?function(e,t,n){if(!kn(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=Mn(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Ln(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Pn(e,t,n,i){return e instanceof Dn?function(e,t,n,i){if(!kn(e.precondition,t))return n;const s=e.value.clone(),r=Fn(e.fieldTransforms,i,t);return s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,i):e instanceof xn?function(e,t,n,i){if(!kn(e.precondition,t))return n;const s=Fn(e.fieldTransforms,i,t),r=t.data;return r.setAll(Ln(e)),r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):function(e,t,n){return kn(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function On(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&X(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof vn&&t instanceof vn||e instanceof In&&t instanceof In?X(e.elements,t.elements,ot):e instanceof Tn&&t instanceof Tn?ot(e.Ae,t.Ae):e instanceof yn&&t instanceof yn}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Dn extends An{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class xn extends An{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ln(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}}),t}function Mn(e,t,n){const i=new Map;O(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){const r=e[s],o=r.transform,a=t.data.field(r.field);i.set(r.field,_n(o,a,n[s]))}return i}function Fn(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,mn(e,r,t))}return i}class Un extends An{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Vn{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const i=this.mutations[t];i.key.isEqual(e.key)&&Rn(i,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Pn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Pn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ln();return this.mutations.forEach(i=>{const s=e.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=t.has(i.key)?null:o;const a=Nn(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(ue.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),pn())}isEqual(e){return this.batchId===e.batchId&&X(this.mutations,e.mutations,(e,t)=>On(e,t))&&X(this.baseMutations,e.baseMutations,(e,t)=>On(e,t))}}class jn{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}var qn,Bn;(Bn=qn||(qn={}))[Bn.OK=0]="OK",Bn[Bn.CANCELLED=1]="CANCELLED",Bn[Bn.UNKNOWN=2]="UNKNOWN",Bn[Bn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Bn[Bn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Bn[Bn.NOT_FOUND=5]="NOT_FOUND",Bn[Bn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Bn[Bn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Bn[Bn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Bn[Bn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Bn[Bn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Bn[Bn.ABORTED=10]="ABORTED",Bn[Bn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Bn[Bn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Bn[Bn.INTERNAL=13]="INTERNAL",Bn[Bn.UNAVAILABLE=14]="UNAVAILABLE",Bn[Bn.DATA_LOSS=15]="DATA_LOSS",new i([4294967295,4294967295],0),Error;class Hn{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wn(e){return O(!!e,49232),ue.fromTimestamp(function(e){const t=We(e);return new le(t.seconds,t.nanos)}(e))}function $n(e,t){const n=function(e){return new te(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function zn(e){const t=function(e){const t=te.fromString(e);return O(function(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}(t),10190,{key:t.toString()}),t}(e);return 4===t.length?te.emptyPath():function(e){return O(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}(t)}function Kn(e){let t=zn(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){O(1===i,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=Gn(e);return t instanceof At&&Rt(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new bt(Qn(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,ve(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new It(n,t)}(n.startAt));let h=null;return n.endAt&&(h=function(e){const t=!e.before,n=e.values||[];return new It(n,t)}(n.endAt)),function(e,t,n,i,s,r,o,a){return new zt(e,t,n,i,s,r,o,a)}(t,s,o,r,a,"F",c,h)}function Gn(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Qn(e.unaryFilter.field);return kt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Qn(e.unaryFilter.field);return kt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Qn(e.unaryFilter.field);return kt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Qn(e.unaryFilter.field);return kt.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return R(61313);default:return R(60726)}}(e):void 0!==e.fieldFilter?function(e){return kt.create(Qn(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return R(58110);default:return R(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return At.create(e.compositeFilter.filters.map(e=>Gn(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return R(1026)}}(e.compositeFilter.op))}(e):R(30097,{filter:e})}function Qn(e){return ie.fromServerFormat(e.fieldPath)}class Yn{constructor(e){this.yt=e}}function Jn(e){const t=Kn({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Yt(t,t.limit,"L"):t}class Xn{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt($e(e.integerValue));else if("doubleValue"in e){const n=$e(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),we(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=We(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ze(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?yt(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):mt(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):R(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const e of Object.keys(n))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const i=st,s=n[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt($e(s)),this.Ot(i,t),this.Ct(n[i],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const e of n)this.Ct(e,t)}Lt(e,t){this.Ft(t,37),se.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Xn.Kt=new Xn;class Zn{constructor(){this.Cn=new ei}addToCollectionParentIndex(e,t){return this.Cn.add(t),me.resolve()}getCollectionParents(e,t){return me.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return me.resolve()}deleteFieldIndex(e,t){return me.resolve()}deleteAllFieldIndexes(e){return me.resolve()}createTargetIndexes(e,t){return me.resolve()}getDocumentsMatchingTarget(e,t){return me.resolve(null)}getIndexType(e,t){return me.resolve(0)}getFieldIndexes(e,t){return me.resolve([])}getNextCollectionGroupToUpdate(e){return me.resolve(null)}getMinOffset(e,t){return me.resolve(pe.min())}getMinOffsetFromCollectionGroup(e,t){return me.resolve(pe.min())}updateCollectionGroup(e,t,n){return me.resolve()}updateIndexEntries(e,t){return me.resolve()}}class ei{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Ue(te.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Ue(te.comparator)).toArray()}}new Uint8Array(0);const ti=41943040;class ni{static withCacheSize(e){return new ni(e,ni.DEFAULT_COLLECTION_PERCENTILE,ni.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}ni.DEFAULT_COLLECTION_PERCENTILE=10,ni.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ni.DEFAULT=new ni(ti,ni.DEFAULT_COLLECTION_PERCENTILE,ni.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ni.DISABLED=new ni(-1,0,0);class ii{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new ii(0)}static cr(){return new ii(-1)}}class si{constructor(){this.changes=new nn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,wt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?me.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ri{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oi{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Pn(n.mutation,e,je.empty(),le.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,pn()).next(()=>t))}getLocalViewOfDocuments(e,t,n=pn()){const i=hn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=an();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=hn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,pn()))}populateOverlays(e,t,n){const i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let s=rn();const r=un(),o=un();return t.forEach((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof xn)?s=s.insert(t.key,t):void 0!==o?(r.set(t.key,o.mutation.getFieldMask()),Pn(o.mutation,t,o.mutation.getFieldMask(),le.now())):r.set(t.key,je.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>r.set(e,t)),t.forEach((e,t)=>o.set(e,new ri(t,r.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){const n=un();let i=new Le((e,t)=>e-t),s=pn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const r=t.get(e);if(null===r)return;let o=n.get(e)||je.empty();o=s.applyToLocalView(r,o),n.set(e,o);const a=(i.get(s.batchId)||pn()).add(e);i=i.insert(s.batchId,a)})}).next(()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,h=ln();c.forEach(e=>{if(!s.has(e)){const i=Nn(t.get(e),n.get(e));null!==i&&h.set(e,i),s=s.add(e)}}),r.push(this.documentOverlayCache.saveOverlays(e,a,h))}return me.waitFor(r)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return function(e){return se.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):me.resolve(hn());let o=-1,a=s;return r.next(t=>me.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?me.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,pn())).next(e=>({batchId:o,changes:cn(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new se(t)).next(e=>{let t=an();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let r=an();return this.indexManager.getCollectionParents(e,s).next(o=>me.forEach(o,o=>{const a=function(e,t){return new zt(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,n,i).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(e=>{s.forEach((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,wt.newInvalidDocument(i)))});let n=an();return e.forEach((e,i)=>{const r=s.get(e);void 0!==r&&Pn(r.mutation,i,je.empty(),le.now()),en(t,i)&&(n=n.insert(e,i))}),n})}}class ai{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return me.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Wn(e.createTime)}}(t)),me.resolve()}getNamedQuery(e,t){return me.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:Jn(e.bundledQuery),readTime:Wn(e.readTime)}}(t)),me.resolve()}}class ci{constructor(){this.overlays=new Le(se.comparator),this.qr=new Map}getOverlay(e,t){return me.resolve(this.overlays.get(t))}getOverlays(e,t){const n=hn();return me.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.St(e,t,i)}),me.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),me.resolve()}getOverlaysForCollection(e,t,n){const i=hn(),s=t.length+1,r=new se(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return me.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Le((e,t)=>e-t);const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=hn(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=hn(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=i)););return me.resolve(o)}St(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new jn(t,n));let s=this.qr.get(t);void 0===s&&(s=pn(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class hi{constructor(){this.sessionToken=Be.EMPTY_BYTE_STRING}getSessionToken(e){return me.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,me.resolve()}}class li{constructor(){this.Qr=new Ue(ui.$r),this.Ur=new Ue(ui.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new ui(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new ui(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new se(new te([])),n=new ui(t,e),i=new ui(t,e+1),s=[];return this.Ur.forEachInRange([n,i],e=>{this.Gr(e),s.push(e.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new se(new te([])),n=new ui(t,e),i=new ui(t,e+1);let s=pn();return this.Ur.forEachInRange([n,i],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new ui(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ui{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return se.comparator(e.key,t.key)||K(e.Yr,t.Yr)}static Kr(e,t){return K(e.Yr,t.Yr)||se.comparator(e.key,t.key)}}class di{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ue(ui.$r)}checkEmpty(e){return me.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Vn(s,t,n,i);this.mutationQueue.push(r);for(const t of i)this.Zr=this.Zr.add(new ui(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return me.resolve(r)}lookupMutationBatch(e,t){return me.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ei(n),s=i<0?0:i;return me.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return me.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return me.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ui(t,0),i=new ui(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,i],e=>{const t=this.Xr(e.Yr);s.push(t)}),me.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ue(K);return t.forEach(e=>{const t=new ui(e,0),i=new ui(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,i],e=>{n=n.add(e.Yr)})}),me.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;se.isDocumentKey(s)||(s=s.child(""));const r=new ui(new se(s),0);let o=new Ue(K);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.Yr)),!0)},r),me.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){O(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return me.forEach(t.mutations,i=>{const s=new ui(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new ui(t,0),i=this.Zr.firstAfterOrEqual(n);return me.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,me.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class pi{constructor(e){this.ri=e,this.docs=new Le(se.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return me.resolve(n?n.document.mutableCopy():wt.newInvalidDocument(t))}getEntries(e,t){let n=rn();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():wt.newInvalidDocument(e))}),me.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=rn();const r=t.path,o=new se(r.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||fe(de(o),n)<=0||(i.has(o.key)||en(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return me.resolve(s)}getAllFromCollectionGroup(e,t,n,i){R(9500)}ii(e,t){return me.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new fi(this)}getSize(e){return me.resolve(this.size)}}class fi extends si{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)}),me.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class gi{constructor(e){this.persistence=e,this.si=new nn(e=>Wt(e),$t),this.lastRemoteSnapshotVersion=ue.min(),this.highestTargetId=0,this.oi=0,this._i=new li,this.targetCount=0,this.ai=ii.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),me.resolve()}getLastRemoteSnapshotVersion(e){return me.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return me.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),me.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),me.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new ii(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,me.resolve()}updateTargetData(e,t){return this.Pr(t),me.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,me.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.si.forEach((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(r),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),me.waitFor(s).next(()=>i)}getTargetCount(e){return me.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return me.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),me.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(t=>{s.push(i.markPotentiallyOrphaned(e,t))}),me.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),me.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return me.resolve(n)}containsKey(e,t){return me.resolve(this._i.containsKey(t))}}class mi{constructor(e,t){this.ui={},this.overlays={},this.ci=new ye(0),this.li=!1,this.li=!0,this.hi=new hi,this.referenceDelegate=e(this),this.Pi=new gi(this),this.indexManager=new Zn,this.remoteDocumentCache=function(e){return new pi(e)}(e=>this.referenceDelegate.Ti(e)),this.serializer=new Yn(t),this.Ii=new ai(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ci,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new di(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){S("MemoryPersistence","Starting transaction:",e);const i=new _i(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(e=>this.referenceDelegate.di(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Ai(e,t){return me.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class _i extends ge{constructor(e){super(),this.currentSequenceNumber=e}}class yi{constructor(e){this.persistence=e,this.Ri=new li,this.Vi=null}static mi(e){return new yi(e)}get fi(){if(this.Vi)return this.Vi;throw R(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),me.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),me.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),me.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return me.forEach(this.fi,n=>{const i=se.fromPath(n);return this.gi(e,i).next(e=>{e||t.removeEntry(i,ue.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return me.or([()=>me.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class vi{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=pn(),i=pn();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new vi(e,t.fromCache,n,i)}}class wi{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ii{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,a.nr)()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}((0,a.ZQ)())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ys(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ws(e,t,i,n).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const n=new wi;return this.Ss(e,t,n).next(i=>{if(s.result=i,this.Vs)return this.bs(e,t,n,i.size)})}).next(()=>s.result)}bs(e,t,n,i){return n.documentReadCount<this.fs?(C()<=o.$b.DEBUG&&S("QueryEngine","SDK will not create cache indexes for query:",Zt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),me.resolve()):(C()<=o.$b.DEBUG&&S("QueryEngine","Query:",Zt(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(C()<=o.$b.DEBUG&&S("QueryEngine","The SDK decides to create cache indexes for query:",Zt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qt(t))):me.resolve())}ys(e,t){if(Kt(t))return me.resolve(null);let n=Qt(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Yt(t,null,"F"),n=Qt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const s=pn(...i);return this.ps.getDocuments(e,s).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{const r=this.Ds(t,i);return this.Cs(t,r,s,n.readTime)?this.ys(e,Yt(t,null,"F")):this.vs(e,r,t,n)}))})))}ws(e,t,n,i){return Kt(t)||i.isEqual(ue.min())?me.resolve(null):this.ps.getDocuments(e,n).next(s=>{const r=this.Ds(t,s);return this.Cs(t,r,n,i)?me.resolve(null):(C()<=o.$b.DEBUG&&S("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Zt(t)),this.vs(e,r,t,function(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,s=ue.fromTimestamp(1e9===i?new le(n+1,0):new le(n,i));return new pe(s,se.empty(),t)}(i,-1)).next(e=>e))})}Ds(e,t){let n=new Ue(function(e){return(t,n)=>{let i=!1;for(const s of Gt(e)){const e=tn(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}(e));return t.forEach((t,i)=>{en(e,i)&&(n=n.add(i))}),n}Cs(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,n){return C()<=o.$b.DEBUG&&S("QueryEngine","Using full collection scan to execute query:",Zt(t)),this.ps.getDocumentsMatchingQuery(e,t,pe.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class Ei{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Le(K),this.xs=new nn(e=>Wt(e),$t),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oi(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}class Ti{constructor(){this.activeTargetIds=fn}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bi{constructor(){this.Mo=new Ti,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ti,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ci{Oo(e){}shutdown(){}}const Si="ConnectivityMonitor";class ki{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){S(Si,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){S(Si,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ai=null;function Ni(){return null===Ai?Ai=268435456+Math.round(2147483648*Math.random()):Ai++,"0x"+Ai.toString(16)}const Ri="RestConnection",Pi={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Oi{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===et?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,s){const r=Ni(),o=this.zo(e,t.toUriEncodedString());S(Ri,`Sending RPC '${e}' ${r}:`,o,n);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,i,s);const{host:h}=new URL(o),l=(0,a.zJ)(h);return this.Jo(e,o,c,n,l).then(t=>(S(Ri,`Received RPC '${e}' ${r}: `,t),t),t=>{throw A(Ri,`RPC '${e}' ${r} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,i,s,r){return this.Go(e,t,n,i,s)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+T,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=Pi[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class Di{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const xi="WebChannelConnection";class Li extends Oi{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,s){const r=Ni();return new Promise((s,o)=>{const a=new l;a.setWithCredentials(!0),a.listenOnce(d.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case p.NO_ERROR:const t=a.getResponseJson();S(xi,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case p.TIMEOUT:S(xi,`RPC '${e}' ${r} timed out`),o(new L(x.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:const n=a.getStatus();if(S(xi,`RPC '${e}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(t)>=0?t:x.UNKNOWN}(t.status);o(new L(e,t.message))}else o(new L(x.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new L(x.UNAVAILABLE,"Connection failed."));break;default:R(9055,{l_:e,streamId:r,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{S(xi,`RPC '${e}' ${r} completed.`)}});const c=JSON.stringify(i);S(xi,`RPC '${e}' ${r} sending request:`,i),a.send(t,"POST",c,n,15)})}T_(e,t,n){const i=Ni(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=_(),o=m(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const h=s.join("");S(xi,`Creating RPC '${e}' stream ${i}: ${h}`,a);const l=r.createWebChannel(h,a);this.I_(l);let d=!1,p=!1;const y=new Di({Yo:t=>{p?S(xi,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(d||(S(xi,`Opening RPC '${e}' stream ${i} transport.`),l.open(),d=!0),S(xi,`RPC '${e}' stream ${i} sending:`,t),l.send(t))},Zo:()=>l.close()}),v=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return v(l,u.EventType.OPEN,()=>{p||(S(xi,`RPC '${e}' stream ${i} transport opened.`),y.o_())}),v(l,u.EventType.CLOSE,()=>{p||(p=!0,S(xi,`RPC '${e}' stream ${i} transport closed`),y.a_(),this.E_(l))}),v(l,u.EventType.ERROR,t=>{p||(p=!0,A(xi,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),y.a_(new L(x.UNAVAILABLE,"The operation could not be completed")))}),v(l,u.EventType.MESSAGE,t=>{if(!p){const n=t.data[0];O(!!n,16349);const s=n,r=s?.error||s[0]?.error;if(r){S(xi,`RPC '${e}' stream ${i} received error:`,r);const t=r.status;let n=function(e){const t=qn[e];if(void 0!==t)return function(e){if(void 0===e)return k("GRPC error has no .code"),x.UNKNOWN;switch(e){case qn.OK:return x.OK;case qn.CANCELLED:return x.CANCELLED;case qn.UNKNOWN:return x.UNKNOWN;case qn.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case qn.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case qn.INTERNAL:return x.INTERNAL;case qn.UNAVAILABLE:return x.UNAVAILABLE;case qn.UNAUTHENTICATED:return x.UNAUTHENTICATED;case qn.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case qn.NOT_FOUND:return x.NOT_FOUND;case qn.ALREADY_EXISTS:return x.ALREADY_EXISTS;case qn.PERMISSION_DENIED:return x.PERMISSION_DENIED;case qn.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case qn.ABORTED:return x.ABORTED;case qn.OUT_OF_RANGE:return x.OUT_OF_RANGE;case qn.UNIMPLEMENTED:return x.UNIMPLEMENTED;case qn.DATA_LOSS:return x.DATA_LOSS;default:return R(39323,{code:e})}}(t)}(t),s=r.message;void 0===n&&(n=x.INTERNAL,s="Unknown error status: "+t+" with message "+r.message),p=!0,y.a_(new L(n,s)),l.close()}else S(xi,`RPC '${e}' stream ${i} received:`,n),y.u_(n)}}),v(o,g.STAT_EVENT,t=>{t.stat===f.PROXY?S(xi,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===f.NOPROXY&&S(xi,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.__()},0),y}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Mi(){return"undefined"!=typeof document?document:null}function Fi(e){return new Hn(e,!0)}class Ui{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&S("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}class Vi{}class ji extends Vi{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new L(x.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,r])=>this.connection.Go(e,$n(t,n),i,s,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(x.UNKNOWN,e.toString())})}Ho(e,t,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Ho(e,$n(t,n),i,r,o,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(x.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class qi{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(k(t),this.aa=!1):S("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Bi="RemoteStore";class Hi{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{zi(this)&&(S(Bi,"Restarting streams for network reachability change."),await async function(e){const t=D(e);t.Ea.add(4),await $i(t),t.Ra.set("Unknown"),t.Ea.delete(4),await Wi(t)}(this))})}),this.Ra=new qi(n,i)}}async function Wi(e){if(zi(e))for(const t of e.da)await t(!0)}async function $i(e){for(const t of e.da)await t(!1)}function zi(e){return 0===D(e).Ea.size}class Ki{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new M,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,o=new Ki(e,t,r,i,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new L(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class Gi{constructor(){this.queries=Qi(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=D(e),i=n.queries;n.queries=Qi(),i.forEach((e,n)=>{for(const e of n.Sa)e.onError(t)})}(this,new L(x.ABORTED,"Firestore shutting down"))}}function Qi(){return new nn(e=>Xt(e),Jt)}var Yi,Ji;(Ji=Yi||(Yi={})).Ma="default",Ji.Cache="cache";class Xi{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Pu={},this.Tu=new nn(e=>Xt(e),Jt),this.Iu=new Map,this.Eu=new Set,this.du=new Le(se.comparator),this.Au=new Map,this.Ru=new li,this.Vu={},this.mu=new Map,this.fu=ii.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function Zi(e,t,n){const i=D(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Tu.forEach((n,i)=>{const s=i.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=D(e);n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(const e of n.Sa)e.va(t)&&(i=!0)}),i&&function(e){e.Ca.forEach(e=>{e.next()})}(n)}(i.eventManager,t),e.length&&i.Pu.H_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function es(e,t){const n=D(e);if(!n.currentUser.isEqual(t)){S("SyncEngine","User change. New user:",t.toKey());const e=await async function(e,t){const n=D(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next(s=>(i=s,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],r=[];let o=pn();for(const e of i){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:s,addedBatchIds:r}))})})}(n.localStore,t);n.currentUser=t,function(e){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new L(x.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await async function(e,t,n){const i=D(e),s=[],r=[],o=[];i.Tu.isEmpty()||(i.Tu.forEach((e,a)=>{o.push(i.pu(a,t,n).then(e=>{if((e||n)&&i.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(a.targetId)?.current;i.sharedClientState.updateQueryState(a.targetId,t?"current":"not-current")}if(e){s.push(e);const t=vi.As(a.targetId,e);r.push(t)}}))}),await Promise.all(o),i.Pu.H_(s),await async function(e,t){const n=D(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>me.forEach(t,t=>me.forEach(t.Es,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>me.forEach(t.ds,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(e){if(!_e(e))throw e;S("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ms.get(t),i=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(i);n.Ms=n.Ms.insert(t,s)}}}(i.localStore,r))}(n,e.Ls)}}class ts{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Fi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,n,i){return new Ei(e,t,n,i)}(this.persistence,new Ii,e.initialUser,this.serializer)}Cu(e){return new mi(yi.mi,this.serializer)}Du(e){return new bi}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ts.provider={build:()=>new ts};class ns{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Zi(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=es.bind(null,this.syncEngine),await async function(e,t){const n=D(e);t?(n.Ea.delete(2),await Wi(n)):t||(n.Ea.add(2),await $i(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Gi}createDatastore(e){const t=Fi(e.databaseInfo.databaseId),n=function(e){return new Li(e)}(e.databaseInfo);return function(e,t,n,i){return new ji(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,i,s){return new Hi(e,t,n,i,s)}(this.localStore,this.datastore,e.asyncQueue,e=>Zi(this.syncEngine,e,0),ki.v()?new ki:new Ci)}createSyncEngine(e,t){return function(e,t,n,i,s,r,o){const a=new Xi(e,t,n,i,s,r);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=D(e);S(Bi,"RemoteStore shutting down."),t.Ea.add(5),await $i(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ns.provider={build:()=>new ns};const is=new Map,ss="firestore.googleapis.com",rs=!0;class os{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new L(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ss,this.ssl=rs}else this.host=e.host,this.ssl=e.ssl??rs;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=ti;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new L(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new L(x.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=function(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new L(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new L(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new L(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class as{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new os({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new L(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new os(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new U;switch(e.type){case"firstParty":return new B(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new L(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=is.get(e);t&&(S("ComponentProvider","Removing Datastore"),is.delete(e),t.terminate())}(this),Promise.resolve()}}class cs{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new cs(this.firestore,e,this._query)}}class hs{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ls(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hs(this.firestore,e,this._key)}toJSON(){return{type:hs._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ae(t,hs._jsonSchema))return new hs(e,n||null,new se(te.fromString(t.referencePath)))}}hs._jsonSchemaVersion="firestore/documentReference/1.0",hs._jsonSchema={type:oe("string",hs._jsonSchemaVersion),referencePath:oe("string")};class ls extends cs{constructor(e,t,n){super(e,t,function(e){return new zt(e)}(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new hs(this.firestore,null,new se(e))}withConverter(e){return new ls(this.firestore,e,this._path)}}const us="AsyncQueue";class ds{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ui(this,"async_queue_retry"),this._c=()=>{const e=Mi();e&&S(us,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Mi();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Mi();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new M;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!_e(e))throw e;S(us,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,k("INTERNAL UNHANDLED ERROR: ",ps(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Ki.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(i),i}uc(){this.nc&&R(47125,{Pc:ps(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ps(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class fs extends as{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new ds,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ds(e),this._firestoreClient=void 0,await e}}}function gs(e,t){const n="object"==typeof e?e:(0,s.Sx)(),i="string"==typeof e?e:t||et,r=(0,s.j6)(n,"firestore").getImmediate({identifier:i});if(!r._initialized){const e=(0,a.yU)("firestore");e&&function(e,t,n,i={}){e=re(e,as);const s=(0,a.zJ)(t),r=e._getSettings(),o={...r,emulatorOptions:e._getEmulatorOptions()},c=`${t}:${n}`;s&&((0,a.gE)(`https://${c}`),(0,a.P1)("Firestore",!0)),r.host!==ss&&r.host!==c&&A("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...r,host:c,ssl:s,emulatorOptions:i};if(!(0,a.bD)(h,o)&&(e._setSettings(h),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=E.MOCK_USER;else{t=(0,a.Fy)(i.mockUserToken,e._app?.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new L(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new E(s)}e._authCredentials=new V(new F(t,n))}}(r,...e)}return r}class ms{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ms(Be.fromBase64String(e))}catch(e){throw new L(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ms(Be.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ms._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ae(e,ms._jsonSchema))return ms.fromBase64String(e.bytes)}}ms._jsonSchemaVersion="firestore/bytes/1.0",ms._jsonSchema={type:oe("string",ms._jsonSchemaVersion),bytes:oe("string")};class _s{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new L(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ys{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ys._jsonSchemaVersion}}static fromJSON(e){if(ae(e,ys._jsonSchema))return new ys(e.latitude,e.longitude)}}ys._jsonSchemaVersion="firestore/geoPoint/1.0",ys._jsonSchema={type:oe("string",ys._jsonSchemaVersion),latitude:oe("number"),longitude:oe("number")};class vs{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:vs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ae(e,vs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new vs(e.vectorValues);throw new L(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}vs._jsonSchemaVersion="firestore/vectorValue/1.0",vs._jsonSchema={type:oe("string",vs._jsonSchemaVersion),vectorValues:oe("object")};const ws=new RegExp("[~\\*/\\[\\]]");function Is(e,t,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new L(x.INVALID_ARGUMENT,a+e+c)}class Es{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new hs(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ts(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(bs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ts extends Es{data(){return super.data()}}function bs(e,t){return"string"==typeof t?function(e,t,n){if(t.search(ws)>=0)throw Is(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new _s(...t.split("."))._internalPath}catch(i){throw Is(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}(e,t):t instanceof _s?t._internalPath:t._delegate._internalPath}class Cs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ss extends Es{constructor(e,t,n,i,s,r){super(e,t,n,i,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ks(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(bs("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ss._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Ss._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ss._jsonSchema={type:oe("string",Ss._jsonSchemaVersion),bundleSource:oe("string","DocumentSnapshot"),bundleName:oe("string"),bundle:oe("string")};class ks extends Ss{data(e={}){return super.data(e)}}class As{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Cs(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ks(this._firestore,this._userDataWriter,n.key,n,new Cs(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const i=new ks(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Cs(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const i=new ks(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Cs(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,r=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:Ns(t.type),doc:i,oldIndex:s,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=As._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=z.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),i.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Ns(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R(61501,{type:e})}}As._jsonSchemaVersion="firestore/querySnapshot/1.0",As._jsonSchema={type:oe("string",As._jsonSchemaVersion),bundleSource:oe("string","QuerySnapshot"),bundleName:oe("string"),bundle:oe("string")},new WeakMap,function(e,t=!0){!function(e){T=e}(s.MF),(0,s.om)(new r.uA("firestore",(e,{instanceIdentifier:n,options:i})=>{const s=e.getProvider("app").getImmediate(),r=new fs(new j(e.getProvider("auth-internal")),new W(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new L(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tt(e.options.projectId,t)}(s,n),s);return i={useFetchStreams:t,...i},r._setSettings(i),r},"PUBLIC").setMultipleInstances(!0)),(0,s.KO)(w,I,e),(0,s.KO)(w,I,"esm2020")}()},602:(e,t,n)=>{n.d(t,{P2:()=>s});var i=n(500);function s(e,t,{blocked:n,upgrade:s,blocking:r,terminated:o}={}){const a=indexedDB.open(e,t),c=(0,i.w)(a);return s&&a.addEventListener("upgradeneeded",e=>{s((0,i.w)(a.result),e.oldVersion,e.newVersion,(0,i.w)(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),c.then(e=>{o&&e.addEventListener("close",()=>o()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),c}const r=["get","getKey","getAll","getAllKeys","count"],o=["put","add","delete","clear"],a=new Map;function c(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(a.get(t))return a.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=o.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!r.includes(n))return;const c=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return a.set(t,c),c}(0,i.r)(e=>({...e,get:(t,n,i)=>c(t,n)||e.get(t,n,i),has:(t,n)=>!!c(t,n)||e.has(t,n)}))},625:(e,t,n)=>{n.d(t,{$L:()=>W,$g:()=>M,A4:()=>p,Am:()=>te,As:()=>$,Cv:()=>K,FA:()=>B,Fy:()=>C,Hk:()=>o,I9:()=>ne,Im:()=>J,K3:()=>c,KA:()=>l,Ku:()=>ue,OE:()=>le,Ov:()=>U,P1:()=>A,T9:()=>w,Tj:()=>y,Uj:()=>u,XA:()=>I,ZQ:()=>N,bD:()=>Z,c1:()=>O,cY:()=>E,dI:()=>ce,eX:()=>j,g:()=>q,gE:()=>b,gR:()=>Q,gz:()=>se,hp:()=>ie,jZ:()=>R,kH:()=>X,kj:()=>he,lT:()=>L,lV:()=>x,mS:()=>m,nr:()=>F,qc:()=>G,sr:()=>D,tD:()=>re,u:()=>d,vA:()=>r,yU:()=>v,yw:()=>Y,zJ:()=>T,zW:()=>V});var i=n(773);const s={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},r=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database ("+s.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const s=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,h=s>>2,l=(3&s)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(u=64)),i.push(n[h],n[l],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],r=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==r||null==o||null==a)throw new h;const c=s<<2|r>>4;if(i.push(c),64!==o){const e=r<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const l=function(e){const t=a(e);return c.encodeByteArray(t,!0)},u=function(e){return l(e).replace(/\./g,"")},d=function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function p(e){return f(void 0,e)}function f(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&g(n)&&(e[n]=f(e[n],t[n]));return e}function g(e){return"__proto__"!==e}function m(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}const _=()=>{try{return(0,i.M)()||m().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},y=e=>_()?.emulatorHosts?.[e],v=e=>{const t=y(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},w=()=>_()?.config,I=e=>_()?.[`_${e}`];class E{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function T(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function b(e){return(await fetch(e,{credentials:"include"})).ok}function C(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e};return[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(r)),""].join(".")}const S={};let k=!1;function A(e,t){if("undefined"==typeof window||"undefined"==typeof document||!T(window.location.host)||S[e]===t||S[e]||k)return;function n(e){return`__firebase__banner__${e}`}S[e]=t;const i="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(S))S[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function r(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(i),t=n("text"),r=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),h=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{k=!0,function(){const e=document.getElementById(i);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(h,c),t.append(h,r,a,n),document.body.appendChild(t)}s?(r.innerText="Preview backend disconnected.",h.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(h.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',r.innerText="Preview backend running in this workspace."),r.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",r):r()}function N(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function R(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(N())}function P(){const e=_()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function O(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function D(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function x(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function L(){const e=N();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function M(){return!0===s.NODE_CLIENT||!0===s.NODE_ADMIN}function F(){return!P()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U(){return!P()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function V(){try{return"object"==typeof indexedDB}catch(e){return!1}}function j(){return new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}class q extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,q.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,B.prototype.create)}}class B{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(H,(e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`})}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new q(i,o,n)}}const H=/\{\$([^}]+)}/g;function W(e){return JSON.parse(e)}function $(e){return JSON.stringify(e)}const z=function(e){let t={},n={},i={},s="";try{const r=e.split(".");t=W(d(r[0])||""),n=W(d(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:s}},K=function(e){const t=z(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},G=function(e){const t=z(e).claims;return"object"==typeof t&&!0===t.admin};function Q(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Y(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function J(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function X(e,t,n){const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=t.call(n,e[s],s,e));return i}function Z(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(ee(n)&&ee(r)){if(!Z(n,r))return!1}else if(n!==r)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function ee(e){return null!==e&&"object"==typeof e}function te(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function ne(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function ie(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class se{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),s=1518500249):(i=o^a^c,s=1859775393):e<60?(i=o&a|c&(o|a),s=2400959708):(i=o^a^c,s=3395469782);const t=(r<<5|r>>>27)+i+h+s+n[e]&4294967295;h=c,c=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<t;){if(0===r)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(s[r]=e.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<t;)if(s[r]=e[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}function re(e,t){const n=new oe(e,t);return n.subscribe.bind(n)}class oe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=ae),void 0===i.error&&(i.error=ae),void 0===i.complete&&(i.complete=ae);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ae(){}function ce(e,t){return`${e} failed: ${t} argument `}const he=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=55296&&s<=56319){const t=s-55296;i++,r(i<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(i)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},le=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function ue(e){return e&&e._delegate?e._delegate:e}},711:(e,t,n)=>{n.d(t,{h1:()=>a,uA:()=>s});var i=n(625);class s{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const r="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:r})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=r){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=r){return this.instances.has(e)}getOptions(e=r){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);const s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===r?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var i;return n||null}normalizeInstanceIdentifier(e=r){return this.component?this.component.multipleInstances?e:r:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},722:(e,t,n)=>{n.d(t,{$b:()=>s,Vy:()=>h});const i=[];var s;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const r={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),s=a[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${i}]  ${e.name}:`,...n)};class h{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?r[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}},773:(e,t,n)=>{n.d(t,{M:()=>i});const i=()=>{}},908:(e,t,n)=>{n.d(t,{CI:()=>i.CI,hg:()=>i.hg,x9:()=>i.x9,xI:()=>i.xI});var i=n(82)},943:(e,t,n)=>{n.d(t,{KO:()=>J,MF:()=>G,Sx:()=>Y,Wp:()=>Q,j6:()=>W,om:()=>H,xZ:()=>$});var i=n(711),s=n(722),r=n(625),o=n(602);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const c="@firebase/app",h="0.14.4",l=new s.Vy("@firebase/app"),u="@firebase/app-compat",d="@firebase/analytics-compat",p="@firebase/analytics",f="@firebase/app-check-compat",g="@firebase/app-check",m="@firebase/auth",_="@firebase/auth-compat",y="@firebase/database",v="@firebase/data-connect",w="@firebase/database-compat",I="@firebase/functions",E="@firebase/functions-compat",T="@firebase/installations",b="@firebase/installations-compat",C="@firebase/messaging",S="@firebase/messaging-compat",k="@firebase/performance",A="@firebase/performance-compat",N="@firebase/remote-config",R="@firebase/remote-config-compat",P="@firebase/storage",O="@firebase/storage-compat",D="@firebase/firestore",x="@firebase/ai",L="@firebase/firestore-compat",M="firebase",F="[DEFAULT]",U={[c]:"fire-core",[u]:"fire-core-compat",[p]:"fire-analytics",[d]:"fire-analytics-compat",[g]:"fire-app-check",[f]:"fire-app-check-compat",[m]:"fire-auth",[_]:"fire-auth-compat",[y]:"fire-rtdb",[v]:"fire-data-connect",[w]:"fire-rtdb-compat",[I]:"fire-fn",[E]:"fire-fn-compat",[T]:"fire-iid",[b]:"fire-iid-compat",[C]:"fire-fcm",[S]:"fire-fcm-compat",[k]:"fire-perf",[A]:"fire-perf-compat",[N]:"fire-rc",[R]:"fire-rc-compat",[P]:"fire-gcs",[O]:"fire-gcs-compat",[D]:"fire-fst",[L]:"fire-fst-compat",[x]:"fire-vertex","fire-js":"fire-js",[M]:"fire-js-all"},V=new Map,j=new Map,q=new Map;function B(e,t){try{e.container.addComponent(t)}catch(n){l.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function H(e){const t=e.name;if(q.has(t))return l.debug(`There were multiple attempts to register component ${t}.`),!1;q.set(t,e);for(const t of V.values())B(t,e);for(const t of j.values())B(t,e);return!0}function W(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function $(e){return null!=e&&void 0!==e.settings}const z=new r.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class K{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw z.create("app-deleted",{appName:this._name})}}const G="12.4.0";function Q(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const s={name:F,automaticDataCollectionEnabled:!0,...t},o=s.name;if("string"!=typeof o||!o)throw z.create("bad-app-name",{appName:String(o)});if(n||(n=(0,r.T9)()),!n)throw z.create("no-options");const a=V.get(o);if(a){if((0,r.bD)(n,a.options)&&(0,r.bD)(s,a.config))return a;throw z.create("duplicate-app",{appName:o})}const c=new i.h1(o);for(const e of q.values())c.addComponent(e);const h=new K(n,s,c);return V.set(o,h),h}function Y(e=F){const t=V.get(e);if(!t&&e===F&&(0,r.T9)())return Q();if(!t)throw z.create("no-app",{appName:e});return t}function J(e,t,n){let s=U[e]??e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void l.warn(e.join(" "))}H(new i.uA(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const X="firebase-heartbeat-store";let Z=null;function ee(){return Z||(Z=(0,o.P2)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(X)}catch(e){console.warn(e)}}}).catch(e=>{throw z.create("idb-open",{originalErrorMessage:e.message})})),Z}async function te(e,t){try{const n=(await ee()).transaction(X,"readwrite"),i=n.objectStore(X);await i.put(t,ne(e)),await n.done}catch(e){if(e instanceof r.g)l.warn(e.message);else{const t=z.create("idb-set",{originalErrorMessage:e?.message});l.warn(t.message)}}}function ne(e){return`${e.name}!${e.options.appId}`}class ie{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new re(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=se();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){l.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=se(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),oe(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),oe(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=(0,r.Uj)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return l.warn(e),""}}}function se(){return(new Date).toISOString().substring(0,10)}class re{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,r.zW)()&&(0,r.eX)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ee()).transaction(X),n=await t.objectStore(X).get(ne(e));return await t.done,n}catch(e){if(e instanceof r.g)l.warn(e.message);else{const t=z.create("idb-get",{originalErrorMessage:e?.message});l.warn(t.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return te(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return te(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function oe(e){return(0,r.Uj)(JSON.stringify({version:2,heartbeats:e})).length}H(new i.uA("platform-logger",e=>new a(e),"PRIVATE")),H(new i.uA("heartbeat",e=>new ie(e),"PRIVATE")),J(c,h,""),J(c,h,"esm2020"),J("fire-js","")}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i=n(109),s=n(908);const r=document.getElementById("login");r&&((0,s.hg)(i.j2,e=>{e&&window.location.replace("/dashboard")}),r.addEventListener("submit",async e=>{e.preventDefault();const t=e.target.email.value,n=e.target.password.value;try{if(!(await(0,s.x9)(i.j2,t,n)).user.emailVerified)return await(0,s.CI)(i.j2),void alert("Please verify your email before logging in.");window.location.replace("/dashboard")}catch(e){alert(e.message)}}))})();